(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[238],{1771:(e,a,s)=>{"use strict";s.d(a,{A:()=>c});var t=s(7876),l=s(4232),n=s(1173),i=s(8546),o=s(4e3),r=s(8230),d=s(4279);function c(e){var a,s;let{session:c,onGameClick:m,targetUserSecret:u=null,targetUserData:g=null}=e,{t:p}=(0,n.B)("common"),[y,h]=(0,l.useState)([]),[_,x]=(0,l.useState)(!0),[f,j]=(0,l.useState)({currentPage:1,totalPages:1,totalGames:0,hasNextPage:!1,hasPrevPage:!1}),v=async function(){var e,a,s;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;if((null==c||null==(e=c.token)?void 0:e.secret)&&(null==(a=window.cConfig)?void 0:a.apiUrl)){x(!0);try{let e=await fetch(window.cConfig.apiUrl+"/api/gameHistory",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({secret:u||(null==c||null==(s=c.token)?void 0:s.secret),page:t,limit:10})});if(e.ok){let a=await e.json();h(a.games),j(a.pagination)}else console.error("Failed to fetch game history"),h([])}catch(e){console.error("Error fetching game history:",e),h([])}finally{x(!1)}}};return((0,l.useEffect)(()=>{var e,a;(null==c||null==(e=c.token)?void 0:e.secret)&&(null==(a=window.cConfig)?void 0:a.apiUrl)&&v(1)},[null==c||null==(a=c.token)?void 0:a.secret,u]),_)?(0,t.jsxs)("div",{className:o.gameHistoryLoading,children:[(0,t.jsx)("div",{className:o.loadingSpinner}),(0,t.jsx)("p",{children:p("loadingGameHistory")})]}):0===y.length?(0,t.jsx)("div",{className:o.gameHistoryEmpty,children:(0,t.jsxs)("div",{className:o.emptyState,children:[(0,t.jsx)("span",{className:o.emptyIcon,children:"\uD83C\uDFAE"}),(0,t.jsx)("h3",{children:p("noGamesPlayed")}),(0,t.jsx)("p",{children:p("startPlayingToSeeHistory")})]})}):(0,t.jsxs)("div",{className:o.gameHistory,children:[(0,t.jsxs)("div",{className:o.gameHistoryHeader,children:[(0,t.jsx)("h3",{children:g?(0,t.jsxs)("span",{style:{display:"flex",alignItems:"center",gap:"6px"},children:["Game History for ",g.username,g.countryCode&&(0,t.jsx)(d.A,{countryCode:g.countryCode,style:{fontSize:"0.9em"}})]}):p("gameHistory")}),g&&(0,t.jsxs)("div",{className:"mod-user-info",style:{fontSize:"0.9rem",color:"#666",marginTop:"5px",display:"flex",gap:"15px",flexWrap:"wrap"},children:[(0,t.jsxs)("span",{children:["Total XP: ",null==(s=g.totalXp)?void 0:s.toLocaleString()]}),(0,t.jsxs)("span",{children:["Elo: ",g.elo]}),(0,t.jsxs)("span",{children:["Games: ",g.totalGamesPlayed]}),(0,t.jsxs)("span",{children:["Joined: ",new Date(g.created_at).toLocaleDateString()]}),g.banned&&(0,t.jsx)("span",{style:{color:"#f44336",fontWeight:"bold"},children:"BANNED"}),g.staff&&(0,t.jsx)("span",{style:{color:"#2196f3",fontWeight:"bold"},children:"STAFF"}),g.supporter&&(0,t.jsx)("span",{style:{color:"#ff9800",fontWeight:"bold"},children:"SUPPORTER"})]}),(0,t.jsx)("span",{className:o.totalGames,children:p("totalGames",{count:f.totalGames})})]}),(0,t.jsx)("div",{className:o.gamesList,children:y.map(e=>{var a,s,l,n,c,u,g,y,h,_,x,f,j,v,H,N,I,b,k,w;let L=(k=e.gameType,({singleplayer:{label:p("singleplayer"),icon:"\uD83D\uDC64",color:"#4CAF50"},ranked_duel:{label:p("rankedDuel"),icon:"⚔️",color:"#FF5722"},unranked_multiplayer:{label:p("multiplayer"),icon:"\uD83D\uDC65",color:"#2196F3"},private_multiplayer:{label:p("privateGame"),icon:"\uD83D\uDD12",color:"#9C27B0"}})[k]||{label:k,icon:"\uD83C\uDFAE",color:"#757575"});return(0,t.jsxs)("div",{className:o.gameItem,onClick:()=>m(e),children:[(0,t.jsxs)("div",{className:o.gameHeader,children:[(0,t.jsxs)("div",{className:o.gameType,children:[(0,t.jsx)("span",{className:o.gameTypeIcon,style:{color:L.color},children:L.icon}),(0,t.jsx)("span",{className:o.gameTypeLabel,children:L.label})]}),(0,t.jsx)("div",{className:o.gameDate,children:(e=>{let a=new Date(e),s=new Date-a,t=Math.floor(s/864e5),l=Math.floor(s/36e5),n=Math.floor(s/6e4);return n<1?p("justNow"):n<60?p("minutesAgo",{minutes:n}):l<24?p("hoursAgo",{hours:l}):t<7?p("daysAgo",{days:t}):a.toLocaleDateString()})(e.endedAt)})]}),(0,t.jsxs)("div",{className:o.gameStats,children:["ranked_duel"===e.gameType?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:o.statItem,children:[(0,t.jsx)("span",{className:o.statLabel,children:p("result")}),(0,t.jsx)("span",{className:o.statValue,style:{color:(null==(a=e.userStats)?void 0:a.finalRank)===1||(null==(s=e.userPlayer)?void 0:s.finalRank)===1?"#4CAF50":"#F44336"},children:(null==(l=e.userStats)?void 0:l.finalRank)===1||(null==(n=e.userPlayer)?void 0:n.finalRank)===1?p("victory"):p("defeat")})]}),(0,t.jsxs)("div",{className:o.statItem,children:[(0,t.jsx)("span",{className:o.statLabel,children:p("elo")}),(0,t.jsxs)("span",{className:o.statValue,style:{color:(null==(u=e.userStats)||null==(c=u.elo)?void 0:c.change)>=0||(null==(y=e.userPlayer)||null==(g=y.elo)?void 0:g.change)>=0?"#4CAF50":"#F44336"},children:[((null==(_=e.userStats)||null==(h=_.elo)?void 0:h.change)||(null==(f=e.userPlayer)||null==(x=f.elo)?void 0:x.change))>0?"+":"",null!=(b=(null==(v=e.userStats)||null==(j=v.elo)?void 0:j.change)||(null==(N=e.userPlayer)||null==(H=N.elo)?void 0:H.change))?b:0]})]}),(0,t.jsxs)("div",{className:o.statItem,children:[(0,t.jsx)("span",{className:o.statLabel,children:p("opponent")}),(0,t.jsx)("span",{className:o.statValue,style:{display:"flex",alignItems:"center",gap:"4px"},children:(null==(I=e.opponent)?void 0:I.username)?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(r,{href:"/user?u=".concat(encodeURIComponent(e.opponent.username)),onClick:e=>e.stopPropagation(),target:"_blank",style:{color:"cyan",textDecoration:"underline",cursor:"pointer"},children:e.opponent.username}),e.opponent.countryCode&&(0,t.jsx)(d.A,{countryCode:e.opponent.countryCode,style:{fontSize:"0.9em"}})]}):p("unknown")})]}),(0,t.jsxs)("div",{className:o.statItem,children:[(0,t.jsx)("span",{className:o.statLabel,children:p("duration")}),(0,t.jsx)("span",{className:o.statValue,children:(0,i.A)(e.totalDuration)})]})]}):(0,t.jsxs)("div",{className:o.statItem,children:[(0,t.jsx)("span",{className:o.statLabel,children:p("points")}),(0,t.jsxs)("span",{className:o.statValue,children:[e.userStats.totalPoints.toLocaleString(),(0,t.jsxs)("span",{className:o.statPercentage,children:["/ ",e.result.maxPossiblePoints.toLocaleString()]})]})]}),e.userStats.totalXp>0&&(0,t.jsxs)("div",{className:o.statItem,children:[(0,t.jsx)("span",{className:o.statLabel,children:"XP"}),(0,t.jsx)("span",{className:o.statValue,children:e.userStats.totalXp})]}),"ranked_duel"!==e.gameType&&(0,t.jsxs)("div",{className:o.statItem,children:[(0,t.jsx)("span",{className:o.statLabel,children:p("duration")}),(0,t.jsx)("span",{className:o.statValue,children:(0,i.A)(e.totalDuration)})]})]}),(0,t.jsxs)("div",{className:o.gameDetails,children:[(0,t.jsxs)("div",{className:o.detailItem,children:[(0,t.jsx)("span",{className:o.detailLabel,children:p("map")}),(0,t.jsx)("span",{className:o.detailValue,children:"all"===(w=e.settings.location)?p("worldwide"):w&&2===w.length&&w===w.toUpperCase()?w:w||p("unknown")})]}),(0,t.jsxs)("div",{className:o.detailItem,children:[(0,t.jsx)("span",{className:o.detailLabel,children:p("rounds")}),(0,t.jsx)("span",{className:o.detailValue,children:e.roundsPlayed})]}),e.multiplayer&&(0,t.jsxs)("div",{className:o.detailItem,children:[(0,t.jsx)("span",{className:o.detailLabel,children:p("players")}),(0,t.jsx)("span",{className:o.detailValue,children:e.multiplayer.playerCount})]})]}),(0,t.jsx)("div",{className:o.gameArrow,children:"→"})]},e.gameId)})}),f.totalPages>1&&(0,t.jsxs)("div",{className:o.pagination,children:[(0,t.jsxs)("button",{className:o.paginationBtn,disabled:!f.hasPrevPage,onClick:()=>v(f.currentPage-1),children:["← ",p("previous")]}),(0,t.jsx)("span",{className:o.paginationInfo,children:p("pageOf",{current:f.currentPage,total:f.totalPages})}),(0,t.jsxs)("button",{className:o.paginationBtn,disabled:!f.hasNextPage,onClick:()=>v(f.currentPage+1),children:[p("next")," →"]})]})]})}},4e3:e=>{e.exports={gameHistory:"gameHistory_gameHistory__Ws5aH",gameHistoryHeader:"gameHistory_gameHistoryHeader__0q6YG",totalGames:"gameHistory_totalGames__hEipY",gameHistoryLoading:"gameHistory_gameHistoryLoading__NBxrm",gameHistoryEmpty:"gameHistory_gameHistoryEmpty__Qcec1",loadingSpinner:"gameHistory_loadingSpinner__gnmdN",spin:"gameHistory_spin__ZhsSL",emptyState:"gameHistory_emptyState__BfCyh",emptyIcon:"gameHistory_emptyIcon__1YDgx",gamesList:"gameHistory_gamesList__eCjZZ",gameItem:"gameHistory_gameItem__DKKQd",gameHeader:"gameHistory_gameHeader__uk_sY",gameType:"gameHistory_gameType__mCFWz",gameTypeIcon:"gameHistory_gameTypeIcon__I2abx",gameTypeLabel:"gameHistory_gameTypeLabel__woRlp",gameDate:"gameHistory_gameDate__qO2XS",gameStats:"gameHistory_gameStats__2_WcE",statItem:"gameHistory_statItem__9aeT7",statLabel:"gameHistory_statLabel__7s__w",statValue:"gameHistory_statValue__0Gxud",statPercentage:"gameHistory_statPercentage__R9uID",gameDetails:"gameHistory_gameDetails___1myx",detailItem:"gameHistory_detailItem__gZTWz",detailLabel:"gameHistory_detailLabel__HjteY",detailValue:"gameHistory_detailValue__UFvV6",gameArrow:"gameHistory_gameArrow__GvPzD",pagination:"gameHistory_pagination__6HN_U",paginationBtn:"gameHistory_paginationBtn__douWX",paginationInfo:"gameHistory_paginationInfo__AebHZ",historicalGameView:"gameHistory_historicalGameView__yDuJy",entering:"gameHistory_entering__p0Ta_",fadeInGameView:"gameHistory_fadeInGameView__TyRsT",exiting:"gameHistory_exiting__k0d9E",historicalGameHeader:"gameHistory_historicalGameHeader__XU5Zj",backButtonHeader:"gameHistory_backButtonHeader__eY18t",backButton:"gameHistory_backButton__nW_m3",gameInfoHeader:"gameHistory_gameInfoHeader__4i83k",historicalGameLoading:"gameHistory_historicalGameLoading__9hgCB",historicalGameError:"gameHistory_historicalGameError__9md9A",loadingContainer:"gameHistory_loadingContainer__qTLGf",errorContainer:"gameHistory_errorContainer__u0eut"}},7648:(e,a,s)=>{"use strict";s.d(a,{A:()=>d});var t=s(7876),l=s(4232),n=s(8847),i=s(1173),o=s(4e3);let r=n(()=>Promise.all([s.e(562),s.e(938),s.e(805),s.e(535),s.e(845),s.e(823)]).then(s.bind(s,1226)),{loadableGenerated:{webpack:()=>[require.resolveWeak("./roundOverScreen")]},ssr:!1});function d(e){var a,s,n;let d,{game:c,session:m,onBack:u,options:g,onUsernameLookup:p}=e,{t:y}=(0,i.B)("common"),[h,_]=(0,l.useState)(null),[x,f]=(0,l.useState)(!0),[j,v]=(0,l.useState)(null),[H,N]=(0,l.useState)(!1),[I,b]=(0,l.useState)(!0);(0,l.useEffect)(()=>{let e=setTimeout(()=>{b(!1)},100);return()=>clearTimeout(e)},[]);let k=()=>{N(!0),setTimeout(()=>{u()},300)};if((0,l.useEffect)(()=>{let e=()=>{k()};return window.addEventListener("gameStarting",e),()=>window.removeEventListener("gameStarting",e)},[]),(0,l.useEffect)(()=>{var e,a;let s=async()=>{var e,a;if(null==(e=window.cConfig)?void 0:e.apiUrl){f(!0),v(null);try{let e=await fetch(window.cConfig.apiUrl+"/api/gameDetails",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({secret:null==m||null==(a=m.token)?void 0:a.secret,gameId:c.gameId})});if(e.ok){let a=await e.json();_(a.game)}else v("Failed to load game details")}catch(e){v("Error loading game details"),console.error("Error fetching game details:",e)}finally{f(!1)}}};c&&c.rounds&&c.players&&(null==g?void 0:g.isModView)?(_(c),f(!1)):c&&(null==m||null==(e=m.token)?void 0:e.secret)&&(null==(a=window.cConfig)?void 0:a.apiUrl)&&s()},[c,null==m||null==(a=m.token)?void 0:a.secret]),x)return(0,t.jsx)("div",{className:o.historicalGameLoading,children:(0,t.jsxs)("div",{className:o.loadingContainer,children:[(0,t.jsx)("div",{className:o.loadingSpinner}),(0,t.jsx)("h3",{children:y("loadingGameDetails")}),(0,t.jsx)("p",{children:y("pleaseWait")})]})});if(j)return(0,t.jsx)("div",{className:o.historicalGameError,children:(0,t.jsxs)("div",{className:o.errorContainer,children:[(0,t.jsx)("h3",{children:y("errorLoadingGame")}),(0,t.jsx)("p",{children:j}),(0,t.jsxs)("button",{className:o.backButton,onClick:u,children:["← ",y("backToHistory")]})]})});if(!h)return(0,t.jsx)("div",{className:o.historicalGameError,children:(0,t.jsxs)("div",{className:o.errorContainer,children:[(0,t.jsx)("h3",{children:y("gameNotFound")}),(0,t.jsx)("p",{children:y("gameNoLongerAvailable")}),(0,t.jsxs)("button",{className:o.backButton,onClick:u,children:["← ",y("backToHistory")]})]})});let w=null==g?void 0:g.isModView,L=null==g?void 0:g.reportedUserId,S=null==g?void 0:g.targetUserId,T=h.rounds.map((e,a)=>{let s=e.guess;if(!s&&w&&e.allGuesses&&e.allGuesses.length>0){let a=S?e.allGuesses.find(e=>e.playerId===S):null,t=L?e.allGuesses.find(e=>e.playerId===L):null,l=a||t||e.allGuesses[0];s={guessLat:l.guessLat,guessLong:l.guessLong,points:l.points,timeTaken:l.timeTaken,xpEarned:l.xpEarned||0,usedHint:l.usedHint||!1}}if(!s)return null;let t={};return e.allGuesses&&e.allGuesses.length>0&&e.allGuesses.forEach(e=>{t[e.playerId]={username:e.username,points:e.points,lat:e.guessLat,long:e.guessLong,timeTaken:e.timeTaken}}),{lat:e.location.lat,long:e.location.long,panoId:e.location.panoId,guessLat:s.guessLat,guessLong:s.guessLong,points:s.points,timeTaken:s.timeTaken,xpEarned:s.xpEarned,usedHint:s.usedHint,players:t}}).filter(e=>null!==e),P=T.reduce((e,a)=>e+a.points,0),G=T.reduce((e,a)=>e+a.timeTaken,0),C=h.result.maxPossiblePoints,E="ranked_duel"===h.gameType,D=(()=>{if(w&&S){let e=h.players.find(e=>e.accountId===S||e.playerId===S);if(e)return e}if(w&&L){let e=h.players.find(e=>e.accountId===L||e.playerId===L);if(e)return e}let e=h.players.find(e=>e.accountId===h.currentUserId);return e||h.players[0]})(),V=null;if(E){let e=h.userPlayer||h.userStats||D;if(e){let a=e.elo||{};V={oldElo:a.before||a.oldElo||0,newElo:a.after||a.newElo||0,eloDiff:a.change||0,winner:1===e.finalRank,draw:(null==(s=h.result)?void 0:s.isDraw)||!1,opponent:null==(n=h.players)?void 0:n.find(e=>e.accountId!==(null==D?void 0:D.accountId)&&e.playerId!==(null==D?void 0:D.playerId))}}}let A=null;return"singleplayer"!==h.gameType&&(A={gameData:{myId:(null==D?void 0:D.playerId)||(null==D?void 0:D.accountId)||h.currentUserId,players:h.players.map(e=>({id:e.playerId,username:e.username,points:e.totalPoints,rank:e.finalRank})),duel:E,history:h.rounds.map(e=>({players:e.allGuesses.map(e=>({id:e.playerId,username:e.username,points:e.points,lat:e.guessLat,lng:e.guessLong,timeTaken:e.timeTaken})),location:{lat:e.location.lat,lng:e.location.long,panoId:e.location.panoId}}))}}),(0,t.jsx)("div",{className:(d=o.historicalGameView,I&&(d+=" ".concat(o.entering)),H&&(d+=" ".concat(o.exiting)),d),children:(0,t.jsx)(r,{history:T,points:P,time:G,maxPoints:C,duel:E,data:V,multiplayerState:A,button1Press:k,button1Text:y("backToHistory"),button2Press:null,button2Text:"",hidden:!1,session:m,gameId:(null==c?void 0:c.gameId)||(null==c?void 0:c._id),options:{...g,onUsernameLookup:p,isModView:null==g?void 0:g.isModView,reportedUserId:null==g?void 0:g.reportedUserId}})})}},8546:(e,a,s)=>{"use strict";function t(e){if(!e||e<0)return"0s";let a=Math.floor(e/3600),s=Math.floor(e%3600/60),t=e%60,l=[];return a>0&&l.push("".concat(a,"h")),s>0&&l.push("".concat(s,"m")),(t>0||0===l.length)&&l.push("".concat(t,"s")),l.join(" ")}s.d(a,{A:()=>t})}}]);