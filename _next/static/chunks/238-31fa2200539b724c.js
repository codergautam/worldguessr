(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[238],{1771:(e,a,s)=>{"use strict";s.d(a,{A:()=>o});var t=s(7876),l=s(4232),n=s(1173),i=s(8546),r=s(4e3);function o(e){var a,s;let{session:o,onGameClick:d,targetUserSecret:c=null,targetUserData:m=null}=e,{t:u}=(0,n.B)("common"),[g,p]=(0,l.useState)([]),[y,h]=(0,l.useState)(!0),[_,x]=(0,l.useState)({currentPage:1,totalPages:1,totalGames:0,hasNextPage:!1,hasPrevPage:!1}),v=async function(){var e,a,s;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;if((null==o||null==(e=o.token)?void 0:e.secret)&&(null==(a=window.cConfig)?void 0:a.apiUrl)){h(!0);try{let e=await fetch(window.cConfig.apiUrl+"/api/gameHistory",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({secret:c||(null==o||null==(s=o.token)?void 0:s.secret),page:t,limit:10})});if(e.ok){let a=await e.json();p(a.games),x(a.pagination)}else console.error("Failed to fetch game history"),p([])}catch(e){console.error("Error fetching game history:",e),p([])}finally{h(!1)}}};return((0,l.useEffect)(()=>{var e,a;(null==o||null==(e=o.token)?void 0:e.secret)&&(null==(a=window.cConfig)?void 0:a.apiUrl)&&v(1)},[null==o||null==(a=o.token)?void 0:a.secret,c]),y)?(0,t.jsxs)("div",{className:r.gameHistoryLoading,children:[(0,t.jsx)("div",{className:r.loadingSpinner}),(0,t.jsx)("p",{children:u("loadingGameHistory")})]}):0===g.length?(0,t.jsx)("div",{className:r.gameHistoryEmpty,children:(0,t.jsxs)("div",{className:r.emptyState,children:[(0,t.jsx)("span",{className:r.emptyIcon,children:"\uD83C\uDFAE"}),(0,t.jsx)("h3",{children:u("noGamesPlayed")}),(0,t.jsx)("p",{children:u("startPlayingToSeeHistory")})]})}):(0,t.jsxs)("div",{className:r.gameHistory,children:[(0,t.jsxs)("div",{className:r.gameHistoryHeader,children:[(0,t.jsx)("h3",{children:m?"Game History for ".concat(m.username):u("gameHistory")}),m&&(0,t.jsxs)("div",{className:"mod-user-info",style:{fontSize:"0.9rem",color:"#666",marginTop:"5px",display:"flex",gap:"15px",flexWrap:"wrap"},children:[(0,t.jsxs)("span",{children:["Total XP: ",null==(s=m.totalXp)?void 0:s.toLocaleString()]}),(0,t.jsxs)("span",{children:["Elo: ",m.elo]}),(0,t.jsxs)("span",{children:["Games: ",m.totalGamesPlayed]}),(0,t.jsxs)("span",{children:["Joined: ",new Date(m.created_at).toLocaleDateString()]}),m.banned&&(0,t.jsx)("span",{style:{color:"#f44336",fontWeight:"bold"},children:"BANNED"}),m.staff&&(0,t.jsx)("span",{style:{color:"#2196f3",fontWeight:"bold"},children:"STAFF"}),m.supporter&&(0,t.jsx)("span",{style:{color:"#ff9800",fontWeight:"bold"},children:"SUPPORTER"})]}),(0,t.jsx)("span",{className:r.totalGames,children:u("totalGames",{count:_.totalGames})})]}),(0,t.jsx)("div",{className:r.gamesList,children:g.map(e=>{var a,s,l,n,o,c,m,g,p,y,h,_,x,v,j,f,H,N,I,b;let k=(I=e.gameType,({singleplayer:{label:u("singleplayer"),icon:"\uD83D\uDC64",color:"#4CAF50"},ranked_duel:{label:u("rankedDuel"),icon:"⚔️",color:"#FF5722"},unranked_multiplayer:{label:u("multiplayer"),icon:"\uD83D\uDC65",color:"#2196F3"},private_multiplayer:{label:u("privateGame"),icon:"\uD83D\uDD12",color:"#9C27B0"}})[I]||{label:I,icon:"\uD83C\uDFAE",color:"#757575"});return(0,t.jsxs)("div",{className:r.gameItem,onClick:()=>d(e),children:[(0,t.jsxs)("div",{className:r.gameHeader,children:[(0,t.jsxs)("div",{className:r.gameType,children:[(0,t.jsx)("span",{className:r.gameTypeIcon,style:{color:k.color},children:k.icon}),(0,t.jsx)("span",{className:r.gameTypeLabel,children:k.label})]}),(0,t.jsx)("div",{className:r.gameDate,children:(e=>{let a=new Date(e),s=new Date-a,t=Math.floor(s/864e5),l=Math.floor(s/36e5),n=Math.floor(s/6e4);return n<1?u("justNow"):n<60?u("minutesAgo",{minutes:n}):l<24?u("hoursAgo",{hours:l}):t<7?u("daysAgo",{days:t}):a.toLocaleDateString()})(e.endedAt)})]}),(0,t.jsxs)("div",{className:r.gameStats,children:["ranked_duel"===e.gameType?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:r.statItem,children:[(0,t.jsx)("span",{className:r.statLabel,children:u("result")}),(0,t.jsx)("span",{className:r.statValue,style:{color:(null==(a=e.userStats)?void 0:a.finalRank)===1||(null==(s=e.userPlayer)?void 0:s.finalRank)===1?"#4CAF50":"#F44336"},children:(null==(l=e.userStats)?void 0:l.finalRank)===1||(null==(n=e.userPlayer)?void 0:n.finalRank)===1?u("victory"):u("defeat")})]}),(0,t.jsxs)("div",{className:r.statItem,children:[(0,t.jsx)("span",{className:r.statLabel,children:u("elo")}),(0,t.jsxs)("span",{className:r.statValue,style:{color:(null==(c=e.userStats)||null==(o=c.elo)?void 0:o.change)>=0||(null==(g=e.userPlayer)||null==(m=g.elo)?void 0:m.change)>=0?"#4CAF50":"#F44336"},children:[((null==(y=e.userStats)||null==(p=y.elo)?void 0:p.change)||(null==(_=e.userPlayer)||null==(h=_.elo)?void 0:h.change))>0?"+":"",null!=(N=(null==(v=e.userStats)||null==(x=v.elo)?void 0:x.change)||(null==(f=e.userPlayer)||null==(j=f.elo)?void 0:j.change))?N:0]})]}),(0,t.jsxs)("div",{className:r.statItem,children:[(0,t.jsx)("span",{className:r.statLabel,children:u("opponent")}),(0,t.jsx)("span",{className:r.statValue,children:(null==(H=e.opponent)?void 0:H.username)||u("unknown")})]}),(0,t.jsxs)("div",{className:r.statItem,children:[(0,t.jsx)("span",{className:r.statLabel,children:u("duration")}),(0,t.jsx)("span",{className:r.statValue,children:(0,i.A)(e.totalDuration)})]})]}):(0,t.jsxs)("div",{className:r.statItem,children:[(0,t.jsx)("span",{className:r.statLabel,children:u("points")}),(0,t.jsxs)("span",{className:r.statValue,children:[e.userStats.totalPoints.toLocaleString(),(0,t.jsxs)("span",{className:r.statPercentage,children:["/ ",e.result.maxPossiblePoints.toLocaleString()]})]})]}),e.userStats.totalXp>0&&(0,t.jsxs)("div",{className:r.statItem,children:[(0,t.jsx)("span",{className:r.statLabel,children:"XP"}),(0,t.jsx)("span",{className:r.statValue,children:e.userStats.totalXp})]}),"ranked_duel"!==e.gameType&&(0,t.jsxs)("div",{className:r.statItem,children:[(0,t.jsx)("span",{className:r.statLabel,children:u("duration")}),(0,t.jsx)("span",{className:r.statValue,children:(0,i.A)(e.totalDuration)})]})]}),(0,t.jsxs)("div",{className:r.gameDetails,children:[(0,t.jsxs)("div",{className:r.detailItem,children:[(0,t.jsx)("span",{className:r.detailLabel,children:u("map")}),(0,t.jsx)("span",{className:r.detailValue,children:"all"===(b=e.settings.location)?u("worldwide"):b&&2===b.length&&b===b.toUpperCase()?b:b||u("unknown")})]}),(0,t.jsxs)("div",{className:r.detailItem,children:[(0,t.jsx)("span",{className:r.detailLabel,children:u("rounds")}),(0,t.jsx)("span",{className:r.detailValue,children:e.roundsPlayed})]}),e.multiplayer&&(0,t.jsxs)("div",{className:r.detailItem,children:[(0,t.jsx)("span",{className:r.detailLabel,children:u("players")}),(0,t.jsx)("span",{className:r.detailValue,children:e.multiplayer.playerCount})]})]}),(0,t.jsx)("div",{className:r.gameArrow,children:"→"})]},e.gameId)})}),_.totalPages>1&&(0,t.jsxs)("div",{className:r.pagination,children:[(0,t.jsxs)("button",{className:r.paginationBtn,disabled:!_.hasPrevPage,onClick:()=>v(_.currentPage-1),children:["← ",u("previous")]}),(0,t.jsx)("span",{className:r.paginationInfo,children:u("pageOf",{current:_.currentPage,total:_.totalPages})}),(0,t.jsxs)("button",{className:r.paginationBtn,disabled:!_.hasNextPage,onClick:()=>v(_.currentPage+1),children:[u("next")," →"]})]})]})}},4e3:e=>{e.exports={gameHistory:"gameHistory_gameHistory__Ws5aH",gameHistoryHeader:"gameHistory_gameHistoryHeader__0q6YG",totalGames:"gameHistory_totalGames__hEipY",gameHistoryLoading:"gameHistory_gameHistoryLoading__NBxrm",gameHistoryEmpty:"gameHistory_gameHistoryEmpty__Qcec1",loadingSpinner:"gameHistory_loadingSpinner__gnmdN",spin:"gameHistory_spin__ZhsSL",emptyState:"gameHistory_emptyState__BfCyh",emptyIcon:"gameHistory_emptyIcon__1YDgx",gamesList:"gameHistory_gamesList__eCjZZ",gameItem:"gameHistory_gameItem__DKKQd",gameHeader:"gameHistory_gameHeader__uk_sY",gameType:"gameHistory_gameType__mCFWz",gameTypeIcon:"gameHistory_gameTypeIcon__I2abx",gameTypeLabel:"gameHistory_gameTypeLabel__woRlp",gameDate:"gameHistory_gameDate__qO2XS",gameStats:"gameHistory_gameStats__2_WcE",statItem:"gameHistory_statItem__9aeT7",statLabel:"gameHistory_statLabel__7s__w",statValue:"gameHistory_statValue__0Gxud",statPercentage:"gameHistory_statPercentage__R9uID",gameDetails:"gameHistory_gameDetails___1myx",detailItem:"gameHistory_detailItem__gZTWz",detailLabel:"gameHistory_detailLabel__HjteY",detailValue:"gameHistory_detailValue__UFvV6",gameArrow:"gameHistory_gameArrow__GvPzD",pagination:"gameHistory_pagination__6HN_U",paginationBtn:"gameHistory_paginationBtn__douWX",paginationInfo:"gameHistory_paginationInfo__AebHZ",historicalGameView:"gameHistory_historicalGameView__yDuJy",entering:"gameHistory_entering__p0Ta_",fadeInGameView:"gameHistory_fadeInGameView__TyRsT",exiting:"gameHistory_exiting__k0d9E",historicalGameHeader:"gameHistory_historicalGameHeader__XU5Zj",backButtonHeader:"gameHistory_backButtonHeader__eY18t",backButton:"gameHistory_backButton__nW_m3",gameInfoHeader:"gameHistory_gameInfoHeader__4i83k",historicalGameLoading:"gameHistory_historicalGameLoading__9hgCB",historicalGameError:"gameHistory_historicalGameError__9md9A",loadingContainer:"gameHistory_loadingContainer__qTLGf",errorContainer:"gameHistory_errorContainer__u0eut"}},7648:(e,a,s)=>{"use strict";s.d(a,{A:()=>d});var t=s(7876),l=s(4232),n=s(8847),i=s(1173),r=s(4e3);let o=n(()=>Promise.all([s.e(562),s.e(938),s.e(805),s.e(535),s.e(845),s.e(297)]).then(s.bind(s,1226)),{loadableGenerated:{webpack:()=>[require.resolveWeak("./roundOverScreen")]},ssr:!1});function d(e){var a,s,n;let d,c,{game:m,session:u,onBack:g,options:p,onUsernameLookup:y}=e,{t:h}=(0,i.B)("common"),[_,x]=(0,l.useState)(null),[v,j]=(0,l.useState)(!0),[f,H]=(0,l.useState)(null),[N,I]=(0,l.useState)(!1),[b,k]=(0,l.useState)(!0);(0,l.useEffect)(()=>{let e=setTimeout(()=>{k(!1)},100);return()=>clearTimeout(e)},[]);let w=()=>{I(!0),setTimeout(()=>{g()},300)};if((0,l.useEffect)(()=>{let e=()=>{w()};return window.addEventListener("gameStarting",e),()=>window.removeEventListener("gameStarting",e)},[]),(0,l.useEffect)(()=>{var e,a;let s=async()=>{var e,a;if(null==(e=window.cConfig)?void 0:e.apiUrl){j(!0),H(null);try{let e=await fetch(window.cConfig.apiUrl+"/api/gameDetails",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({secret:null==u||null==(a=u.token)?void 0:a.secret,gameId:m.gameId})});if(e.ok){let a=await e.json();x(a.game)}else H("Failed to load game details")}catch(e){H("Error loading game details"),console.error("Error fetching game details:",e)}finally{j(!1)}}};m&&m.rounds&&m.players&&(null==p?void 0:p.isModView)?(x(m),j(!1)):m&&(null==u||null==(e=u.token)?void 0:e.secret)&&(null==(a=window.cConfig)?void 0:a.apiUrl)&&s()},[m,null==u||null==(a=u.token)?void 0:a.secret]),v)return(0,t.jsx)("div",{className:r.historicalGameLoading,children:(0,t.jsxs)("div",{className:r.loadingContainer,children:[(0,t.jsx)("div",{className:r.loadingSpinner}),(0,t.jsx)("h3",{children:h("loadingGameDetails")}),(0,t.jsx)("p",{children:h("pleaseWait")})]})});if(f)return(0,t.jsx)("div",{className:r.historicalGameError,children:(0,t.jsxs)("div",{className:r.errorContainer,children:[(0,t.jsx)("h3",{children:h("errorLoadingGame")}),(0,t.jsx)("p",{children:f}),(0,t.jsxs)("button",{className:r.backButton,onClick:g,children:["← ",h("backToHistory")]})]})});if(!_)return(0,t.jsx)("div",{className:r.historicalGameError,children:(0,t.jsxs)("div",{className:r.errorContainer,children:[(0,t.jsx)("h3",{children:h("gameNotFound")}),(0,t.jsx)("p",{children:h("gameNoLongerAvailable")}),(0,t.jsxs)("button",{className:r.backButton,onClick:g,children:["← ",h("backToHistory")]})]})});let L=null==p?void 0:p.isModView,S=null==p?void 0:p.reportedUserId,T=_.rounds.map((e,a)=>{let s=e.guess;if(!s&&L&&e.allGuesses&&e.allGuesses.length>0){let a=(S?e.allGuesses.find(e=>e.playerId===S):null)||e.allGuesses[0];s={guessLat:a.guessLat,guessLong:a.guessLong,points:a.points,timeTaken:a.timeTaken,xpEarned:a.xpEarned||0,usedHint:a.usedHint||!1}}if(!s)return null;let t={};return e.allGuesses&&e.allGuesses.length>0&&e.allGuesses.forEach(e=>{t[e.playerId]={username:e.username,points:e.points,lat:e.guessLat,long:e.guessLong,timeTaken:e.timeTaken}}),{lat:e.location.lat,long:e.location.long,panoId:e.location.panoId,guessLat:s.guessLat,guessLong:s.guessLong,points:s.points,timeTaken:s.timeTaken,xpEarned:s.xpEarned,usedHint:s.usedHint,players:t}}).filter(e=>null!==e),P=T.reduce((e,a)=>e+a.points,0),G=T.reduce((e,a)=>e+a.timeTaken,0),E=_.result.maxPossiblePoints,C="ranked_duel"===_.gameType,D=(d=_.players.find(e=>e.accountId===_.currentUserId))||L&&S&&(d=_.players.find(e=>e.accountId===S||e.playerId===S))?d:_.players[0],V=null;if(C){let e=_.userPlayer||_.userStats||D;if(e){let a=e.elo||{};V={oldElo:a.before||a.oldElo||0,newElo:a.after||a.newElo||0,eloDiff:a.change||0,winner:1===e.finalRank,draw:(null==(s=_.result)?void 0:s.isDraw)||!1,opponent:null==(n=_.players)?void 0:n.find(e=>e.accountId!==(null==D?void 0:D.accountId)&&e.playerId!==(null==D?void 0:D.playerId))}}}let A=null;return"singleplayer"!==_.gameType&&(A={gameData:{myId:(null==D?void 0:D.playerId)||(null==D?void 0:D.accountId)||_.currentUserId,players:_.players.map(e=>({id:e.playerId,username:e.username,points:e.totalPoints,rank:e.finalRank})),duel:C,history:_.rounds.map(e=>({players:e.allGuesses.map(e=>({id:e.playerId,username:e.username,points:e.points,lat:e.guessLat,lng:e.guessLong,timeTaken:e.timeTaken})),location:{lat:e.location.lat,lng:e.location.long,panoId:e.location.panoId}}))}}),(0,t.jsx)("div",{className:(c=r.historicalGameView,b&&(c+=" ".concat(r.entering)),N&&(c+=" ".concat(r.exiting)),c),children:(0,t.jsx)(o,{history:T,points:P,time:G,maxPoints:E,duel:C,data:V,multiplayerState:A,button1Press:w,button1Text:h("backToHistory"),button2Press:null,button2Text:"",hidden:!1,session:u,gameId:(null==m?void 0:m.gameId)||(null==m?void 0:m._id),options:{...p,onUsernameLookup:y,isModView:null==p?void 0:p.isModView,reportedUserId:null==p?void 0:p.reportedUserId}})})}},8546:(e,a,s)=>{"use strict";function t(e){if(!e||e<0)return"0s";let a=Math.floor(e/3600),s=Math.floor(e%3600/60),t=e%60,l=[];return a>0&&l.push("".concat(a,"h")),s>0&&l.push("".concat(s,"m")),(t>0||0===l.length)&&l.push("".concat(t,"s")),l.join(" ")}s.d(a,{A:()=>t})}}]);