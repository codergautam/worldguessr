(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[238],{1771:(e,a,s)=>{"use strict";s.d(a,{A:()=>d});var t=s(7876),l=s(4232),n=s(1173),i=s(8546),o=s(4e3),r=s(8230);function d(e){var a,s;let{session:d,onGameClick:c,targetUserSecret:m=null,targetUserData:u=null}=e,{t:g}=(0,n.B)("common"),[p,y]=(0,l.useState)([]),[h,_]=(0,l.useState)(!0),[x,v]=(0,l.useState)({currentPage:1,totalPages:1,totalGames:0,hasNextPage:!1,hasPrevPage:!1}),j=async function(){var e,a,s;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;if((null==d||null==(e=d.token)?void 0:e.secret)&&(null==(a=window.cConfig)?void 0:a.apiUrl)){_(!0);try{let e=await fetch(window.cConfig.apiUrl+"/api/gameHistory",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({secret:m||(null==d||null==(s=d.token)?void 0:s.secret),page:t,limit:10})});if(e.ok){let a=await e.json();y(a.games),v(a.pagination)}else console.error("Failed to fetch game history"),y([])}catch(e){console.error("Error fetching game history:",e),y([])}finally{_(!1)}}};return((0,l.useEffect)(()=>{var e,a;(null==d||null==(e=d.token)?void 0:e.secret)&&(null==(a=window.cConfig)?void 0:a.apiUrl)&&j(1)},[null==d||null==(a=d.token)?void 0:a.secret,m]),h)?(0,t.jsxs)("div",{className:o.gameHistoryLoading,children:[(0,t.jsx)("div",{className:o.loadingSpinner}),(0,t.jsx)("p",{children:g("loadingGameHistory")})]}):0===p.length?(0,t.jsx)("div",{className:o.gameHistoryEmpty,children:(0,t.jsxs)("div",{className:o.emptyState,children:[(0,t.jsx)("span",{className:o.emptyIcon,children:"\uD83C\uDFAE"}),(0,t.jsx)("h3",{children:g("noGamesPlayed")}),(0,t.jsx)("p",{children:g("startPlayingToSeeHistory")})]})}):(0,t.jsxs)("div",{className:o.gameHistory,children:[(0,t.jsxs)("div",{className:o.gameHistoryHeader,children:[(0,t.jsx)("h3",{children:u?"Game History for ".concat(u.username):g("gameHistory")}),u&&(0,t.jsxs)("div",{className:"mod-user-info",style:{fontSize:"0.9rem",color:"#666",marginTop:"5px",display:"flex",gap:"15px",flexWrap:"wrap"},children:[(0,t.jsxs)("span",{children:["Total XP: ",null==(s=u.totalXp)?void 0:s.toLocaleString()]}),(0,t.jsxs)("span",{children:["Elo: ",u.elo]}),(0,t.jsxs)("span",{children:["Games: ",u.totalGamesPlayed]}),(0,t.jsxs)("span",{children:["Joined: ",new Date(u.created_at).toLocaleDateString()]}),u.banned&&(0,t.jsx)("span",{style:{color:"#f44336",fontWeight:"bold"},children:"BANNED"}),u.staff&&(0,t.jsx)("span",{style:{color:"#2196f3",fontWeight:"bold"},children:"STAFF"}),u.supporter&&(0,t.jsx)("span",{style:{color:"#ff9800",fontWeight:"bold"},children:"SUPPORTER"})]}),(0,t.jsx)("span",{className:o.totalGames,children:g("totalGames",{count:x.totalGames})})]}),(0,t.jsx)("div",{className:o.gamesList,children:p.map(e=>{var a,s,l,n,d,m,u,p,y,h,_,x,v,j,f,H,N,I,b,k;let w=(b=e.gameType,({singleplayer:{label:g("singleplayer"),icon:"\uD83D\uDC64",color:"#4CAF50"},ranked_duel:{label:g("rankedDuel"),icon:"⚔️",color:"#FF5722"},unranked_multiplayer:{label:g("multiplayer"),icon:"\uD83D\uDC65",color:"#2196F3"},private_multiplayer:{label:g("privateGame"),icon:"\uD83D\uDD12",color:"#9C27B0"}})[b]||{label:b,icon:"\uD83C\uDFAE",color:"#757575"});return(0,t.jsxs)("div",{className:o.gameItem,onClick:()=>c(e),children:[(0,t.jsxs)("div",{className:o.gameHeader,children:[(0,t.jsxs)("div",{className:o.gameType,children:[(0,t.jsx)("span",{className:o.gameTypeIcon,style:{color:w.color},children:w.icon}),(0,t.jsx)("span",{className:o.gameTypeLabel,children:w.label})]}),(0,t.jsx)("div",{className:o.gameDate,children:(e=>{let a=new Date(e),s=new Date-a,t=Math.floor(s/864e5),l=Math.floor(s/36e5),n=Math.floor(s/6e4);return n<1?g("justNow"):n<60?g("minutesAgo",{minutes:n}):l<24?g("hoursAgo",{hours:l}):t<7?g("daysAgo",{days:t}):a.toLocaleDateString()})(e.endedAt)})]}),(0,t.jsxs)("div",{className:o.gameStats,children:["ranked_duel"===e.gameType?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:o.statItem,children:[(0,t.jsx)("span",{className:o.statLabel,children:g("result")}),(0,t.jsx)("span",{className:o.statValue,style:{color:(null==(a=e.userStats)?void 0:a.finalRank)===1||(null==(s=e.userPlayer)?void 0:s.finalRank)===1?"#4CAF50":"#F44336"},children:(null==(l=e.userStats)?void 0:l.finalRank)===1||(null==(n=e.userPlayer)?void 0:n.finalRank)===1?g("victory"):g("defeat")})]}),(0,t.jsxs)("div",{className:o.statItem,children:[(0,t.jsx)("span",{className:o.statLabel,children:g("elo")}),(0,t.jsxs)("span",{className:o.statValue,style:{color:(null==(m=e.userStats)||null==(d=m.elo)?void 0:d.change)>=0||(null==(p=e.userPlayer)||null==(u=p.elo)?void 0:u.change)>=0?"#4CAF50":"#F44336"},children:[((null==(h=e.userStats)||null==(y=h.elo)?void 0:y.change)||(null==(x=e.userPlayer)||null==(_=x.elo)?void 0:_.change))>0?"+":"",null!=(I=(null==(j=e.userStats)||null==(v=j.elo)?void 0:v.change)||(null==(H=e.userPlayer)||null==(f=H.elo)?void 0:f.change))?I:0]})]}),(0,t.jsxs)("div",{className:o.statItem,children:[(0,t.jsx)("span",{className:o.statLabel,children:g("opponent")}),(0,t.jsx)("span",{className:o.statValue,children:(null==(N=e.opponent)?void 0:N.username)?(0,t.jsx)(r,{href:"/user?u=".concat(encodeURIComponent(e.opponent.username)),onClick:e=>e.stopPropagation(),target:"_blank",style:{color:"cyan",textDecoration:"underline",cursor:"pointer"},children:e.opponent.username}):g("unknown")})]}),(0,t.jsxs)("div",{className:o.statItem,children:[(0,t.jsx)("span",{className:o.statLabel,children:g("duration")}),(0,t.jsx)("span",{className:o.statValue,children:(0,i.A)(e.totalDuration)})]})]}):(0,t.jsxs)("div",{className:o.statItem,children:[(0,t.jsx)("span",{className:o.statLabel,children:g("points")}),(0,t.jsxs)("span",{className:o.statValue,children:[e.userStats.totalPoints.toLocaleString(),(0,t.jsxs)("span",{className:o.statPercentage,children:["/ ",e.result.maxPossiblePoints.toLocaleString()]})]})]}),e.userStats.totalXp>0&&(0,t.jsxs)("div",{className:o.statItem,children:[(0,t.jsx)("span",{className:o.statLabel,children:"XP"}),(0,t.jsx)("span",{className:o.statValue,children:e.userStats.totalXp})]}),"ranked_duel"!==e.gameType&&(0,t.jsxs)("div",{className:o.statItem,children:[(0,t.jsx)("span",{className:o.statLabel,children:g("duration")}),(0,t.jsx)("span",{className:o.statValue,children:(0,i.A)(e.totalDuration)})]})]}),(0,t.jsxs)("div",{className:o.gameDetails,children:[(0,t.jsxs)("div",{className:o.detailItem,children:[(0,t.jsx)("span",{className:o.detailLabel,children:g("map")}),(0,t.jsx)("span",{className:o.detailValue,children:"all"===(k=e.settings.location)?g("worldwide"):k&&2===k.length&&k===k.toUpperCase()?k:k||g("unknown")})]}),(0,t.jsxs)("div",{className:o.detailItem,children:[(0,t.jsx)("span",{className:o.detailLabel,children:g("rounds")}),(0,t.jsx)("span",{className:o.detailValue,children:e.roundsPlayed})]}),e.multiplayer&&(0,t.jsxs)("div",{className:o.detailItem,children:[(0,t.jsx)("span",{className:o.detailLabel,children:g("players")}),(0,t.jsx)("span",{className:o.detailValue,children:e.multiplayer.playerCount})]})]}),(0,t.jsx)("div",{className:o.gameArrow,children:"→"})]},e.gameId)})}),x.totalPages>1&&(0,t.jsxs)("div",{className:o.pagination,children:[(0,t.jsxs)("button",{className:o.paginationBtn,disabled:!x.hasPrevPage,onClick:()=>j(x.currentPage-1),children:["← ",g("previous")]}),(0,t.jsx)("span",{className:o.paginationInfo,children:g("pageOf",{current:x.currentPage,total:x.totalPages})}),(0,t.jsxs)("button",{className:o.paginationBtn,disabled:!x.hasNextPage,onClick:()=>j(x.currentPage+1),children:[g("next")," →"]})]})]})}},4e3:e=>{e.exports={gameHistory:"gameHistory_gameHistory__Ws5aH",gameHistoryHeader:"gameHistory_gameHistoryHeader__0q6YG",totalGames:"gameHistory_totalGames__hEipY",gameHistoryLoading:"gameHistory_gameHistoryLoading__NBxrm",gameHistoryEmpty:"gameHistory_gameHistoryEmpty__Qcec1",loadingSpinner:"gameHistory_loadingSpinner__gnmdN",spin:"gameHistory_spin__ZhsSL",emptyState:"gameHistory_emptyState__BfCyh",emptyIcon:"gameHistory_emptyIcon__1YDgx",gamesList:"gameHistory_gamesList__eCjZZ",gameItem:"gameHistory_gameItem__DKKQd",gameHeader:"gameHistory_gameHeader__uk_sY",gameType:"gameHistory_gameType__mCFWz",gameTypeIcon:"gameHistory_gameTypeIcon__I2abx",gameTypeLabel:"gameHistory_gameTypeLabel__woRlp",gameDate:"gameHistory_gameDate__qO2XS",gameStats:"gameHistory_gameStats__2_WcE",statItem:"gameHistory_statItem__9aeT7",statLabel:"gameHistory_statLabel__7s__w",statValue:"gameHistory_statValue__0Gxud",statPercentage:"gameHistory_statPercentage__R9uID",gameDetails:"gameHistory_gameDetails___1myx",detailItem:"gameHistory_detailItem__gZTWz",detailLabel:"gameHistory_detailLabel__HjteY",detailValue:"gameHistory_detailValue__UFvV6",gameArrow:"gameHistory_gameArrow__GvPzD",pagination:"gameHistory_pagination__6HN_U",paginationBtn:"gameHistory_paginationBtn__douWX",paginationInfo:"gameHistory_paginationInfo__AebHZ",historicalGameView:"gameHistory_historicalGameView__yDuJy",entering:"gameHistory_entering__p0Ta_",fadeInGameView:"gameHistory_fadeInGameView__TyRsT",exiting:"gameHistory_exiting__k0d9E",historicalGameHeader:"gameHistory_historicalGameHeader__XU5Zj",backButtonHeader:"gameHistory_backButtonHeader__eY18t",backButton:"gameHistory_backButton__nW_m3",gameInfoHeader:"gameHistory_gameInfoHeader__4i83k",historicalGameLoading:"gameHistory_historicalGameLoading__9hgCB",historicalGameError:"gameHistory_historicalGameError__9md9A",loadingContainer:"gameHistory_loadingContainer__qTLGf",errorContainer:"gameHistory_errorContainer__u0eut"}},7648:(e,a,s)=>{"use strict";s.d(a,{A:()=>d});var t=s(7876),l=s(4232),n=s(8847),i=s(1173),o=s(4e3);let r=n(()=>Promise.all([s.e(562),s.e(938),s.e(805),s.e(535),s.e(845),s.e(297)]).then(s.bind(s,1226)),{loadableGenerated:{webpack:()=>[require.resolveWeak("./roundOverScreen")]},ssr:!1});function d(e){var a,s,n;let d,c,{game:m,session:u,onBack:g,options:p,onUsernameLookup:y}=e,{t:h}=(0,i.B)("common"),[_,x]=(0,l.useState)(null),[v,j]=(0,l.useState)(!0),[f,H]=(0,l.useState)(null),[N,I]=(0,l.useState)(!1),[b,k]=(0,l.useState)(!0);(0,l.useEffect)(()=>{let e=setTimeout(()=>{k(!1)},100);return()=>clearTimeout(e)},[]);let w=()=>{I(!0),setTimeout(()=>{g()},300)};if((0,l.useEffect)(()=>{let e=()=>{w()};return window.addEventListener("gameStarting",e),()=>window.removeEventListener("gameStarting",e)},[]),(0,l.useEffect)(()=>{var e,a;let s=async()=>{var e,a;if(null==(e=window.cConfig)?void 0:e.apiUrl){j(!0),H(null);try{let e=await fetch(window.cConfig.apiUrl+"/api/gameDetails",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({secret:null==u||null==(a=u.token)?void 0:a.secret,gameId:m.gameId})});if(e.ok){let a=await e.json();x(a.game)}else H("Failed to load game details")}catch(e){H("Error loading game details"),console.error("Error fetching game details:",e)}finally{j(!1)}}};m&&m.rounds&&m.players&&(null==p?void 0:p.isModView)?(x(m),j(!1)):m&&(null==u||null==(e=u.token)?void 0:e.secret)&&(null==(a=window.cConfig)?void 0:a.apiUrl)&&s()},[m,null==u||null==(a=u.token)?void 0:a.secret]),v)return(0,t.jsx)("div",{className:o.historicalGameLoading,children:(0,t.jsxs)("div",{className:o.loadingContainer,children:[(0,t.jsx)("div",{className:o.loadingSpinner}),(0,t.jsx)("h3",{children:h("loadingGameDetails")}),(0,t.jsx)("p",{children:h("pleaseWait")})]})});if(f)return(0,t.jsx)("div",{className:o.historicalGameError,children:(0,t.jsxs)("div",{className:o.errorContainer,children:[(0,t.jsx)("h3",{children:h("errorLoadingGame")}),(0,t.jsx)("p",{children:f}),(0,t.jsxs)("button",{className:o.backButton,onClick:g,children:["← ",h("backToHistory")]})]})});if(!_)return(0,t.jsx)("div",{className:o.historicalGameError,children:(0,t.jsxs)("div",{className:o.errorContainer,children:[(0,t.jsx)("h3",{children:h("gameNotFound")}),(0,t.jsx)("p",{children:h("gameNoLongerAvailable")}),(0,t.jsxs)("button",{className:o.backButton,onClick:g,children:["← ",h("backToHistory")]})]})});let L=null==p?void 0:p.isModView,S=null==p?void 0:p.reportedUserId,T=_.rounds.map((e,a)=>{let s=e.guess;if(!s&&L&&e.allGuesses&&e.allGuesses.length>0){let a=(S?e.allGuesses.find(e=>e.playerId===S):null)||e.allGuesses[0];s={guessLat:a.guessLat,guessLong:a.guessLong,points:a.points,timeTaken:a.timeTaken,xpEarned:a.xpEarned||0,usedHint:a.usedHint||!1}}if(!s)return null;let t={};return e.allGuesses&&e.allGuesses.length>0&&e.allGuesses.forEach(e=>{t[e.playerId]={username:e.username,points:e.points,lat:e.guessLat,long:e.guessLong,timeTaken:e.timeTaken}}),{lat:e.location.lat,long:e.location.long,panoId:e.location.panoId,guessLat:s.guessLat,guessLong:s.guessLong,points:s.points,timeTaken:s.timeTaken,xpEarned:s.xpEarned,usedHint:s.usedHint,players:t}}).filter(e=>null!==e),P=T.reduce((e,a)=>e+a.points,0),G=T.reduce((e,a)=>e+a.timeTaken,0),C=_.result.maxPossiblePoints,E="ranked_duel"===_.gameType,D=(d=_.players.find(e=>e.accountId===_.currentUserId))||L&&S&&(d=_.players.find(e=>e.accountId===S||e.playerId===S))?d:_.players[0],V=null;if(E){let e=_.userPlayer||_.userStats||D;if(e){let a=e.elo||{};V={oldElo:a.before||a.oldElo||0,newElo:a.after||a.newElo||0,eloDiff:a.change||0,winner:1===e.finalRank,draw:(null==(s=_.result)?void 0:s.isDraw)||!1,opponent:null==(n=_.players)?void 0:n.find(e=>e.accountId!==(null==D?void 0:D.accountId)&&e.playerId!==(null==D?void 0:D.playerId))}}}let A=null;return"singleplayer"!==_.gameType&&(A={gameData:{myId:(null==D?void 0:D.playerId)||(null==D?void 0:D.accountId)||_.currentUserId,players:_.players.map(e=>({id:e.playerId,username:e.username,points:e.totalPoints,rank:e.finalRank})),duel:E,history:_.rounds.map(e=>({players:e.allGuesses.map(e=>({id:e.playerId,username:e.username,points:e.points,lat:e.guessLat,lng:e.guessLong,timeTaken:e.timeTaken})),location:{lat:e.location.lat,lng:e.location.long,panoId:e.location.panoId}}))}}),(0,t.jsx)("div",{className:(c=o.historicalGameView,b&&(c+=" ".concat(o.entering)),N&&(c+=" ".concat(o.exiting)),c),children:(0,t.jsx)(r,{history:T,points:P,time:G,maxPoints:C,duel:E,data:V,multiplayerState:A,button1Press:w,button1Text:h("backToHistory"),button2Press:null,button2Text:"",hidden:!1,session:u,gameId:(null==m?void 0:m.gameId)||(null==m?void 0:m._id),options:{...p,onUsernameLookup:y,isModView:null==p?void 0:p.isModView,reportedUserId:null==p?void 0:p.reportedUserId}})})}},8546:(e,a,s)=>{"use strict";function t(e){if(!e||e<0)return"0s";let a=Math.floor(e/3600),s=Math.floor(e%3600/60),t=e%60,l=[];return a>0&&l.push("".concat(a,"h")),s>0&&l.push("".concat(s,"m")),(t>0||0===l.length)&&l.push("".concat(t,"s")),l.join(" ")}s.d(a,{A:()=>t})}}]);