(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[299],{35:(e,n,t)=>{"use strict";t.d(n,{N:()=>a,V:()=>c});var r=t(4232),l=t(5947),o=t(5073),i=t(1567),u=t(8420);function a(e,n){(0,r.useEffect)(function(){return(n.layerContainer??n.map).addLayer(e.instance),function(){n.layerContainer?.removeLayer(e.instance),n.map.removeLayer(e.instance)}},[n,e])}function c(e){return function(n){let t=(0,o.U$)(),r=e((0,u.P)(n,t),t);return(0,l.z)(t.map,n.attribution),(0,i.x)(r.current,n.eventHandlers),a(r.current,t),r}}},723:(e,n,t)=>{"use strict";t.d(n,{T:()=>o});var r=t(4232),l=t(5073);function o(e){return function(n){let t=(0,l.U$)(),o=e(n,t),{instance:i}=o.current,u=(0,r.useRef)(n.position),{position:a}=n;return(0,r.useEffect)(function(){return i.addTo(t.map),function(){i.remove()}},[t.map,i]),(0,r.useEffect)(function(){null!=a&&a!==u.current&&(i.setPosition(a),u.current=a)},[i,a]),o}}},1567:(e,n,t)=>{"use strict";t.d(n,{x:()=>l});var r=t(4232);function l(e,n){let t=(0,r.useRef)();(0,r.useEffect)(function(){return null!=n&&e.instance.on(n),t.current=n,function(){null!=t.current&&e.instance.off(t.current),t.current=null}},[e,n])}},1782:()=>{},1937:(e,n,t)=>{"use strict";t.d(n,{m:()=>u});var r=t(4986),l=t(2526),o=t(2133),i=t(4232);let u=(0,r.wk)(function(e,n){let t=new o.Tooltip(e,n.overlayContainer);return(0,l.Q)(t,n)},function(e,n,{position:t},r){(0,i.useEffect)(function(){let l=n.overlayContainer;if(null==l)return;let{instance:o}=e,i=e=>{e.tooltip===o&&(null!=t&&o.setLatLng(t),o.update(),r(!0))},u=e=>{e.tooltip===o&&r(!1)};return l.on({tooltipopen:i,tooltipclose:u}),l.bindTooltip(o),function(){l.off({tooltipopen:i,tooltipclose:u}),null!=l._map&&l.unbindTooltip()}},[e,n,r,t])})},2349:(e,n,t)=>{"use strict";t.d(n,{B7:()=>i,KU:()=>a,jU:()=>u});var r=t(4232),l=t(8477),o=t(5073);function i(e){return(0,r.forwardRef)(function(n,t){let{instance:l,context:i}=e(n).current;return(0,r.useImperativeHandle)(t,()=>l),null==n.children?null:r.createElement(o.hL,{value:i},n.children)})}function u(e){return(0,r.forwardRef)(function(n,t){let[o,i]=(0,r.useState)(!1),{instance:u}=e(n,i).current;(0,r.useImperativeHandle)(t,()=>u),(0,r.useEffect)(function(){o&&u.update()},[u,o,n.children]);let a=u._contentNode;return a?(0,l.createPortal)(n.children,a):null})}function a(e){return(0,r.forwardRef)(function(n,t){let{instance:l}=e(n).current;return(0,r.useImperativeHandle)(t,()=>l),null})}},2526:(e,n,t)=>{"use strict";t.d(n,{K:()=>o,Q:()=>l});var r=t(4232);function l(e,n,t){return Object.freeze({instance:e,context:n,container:t})}function o(e,n){return null==n?function(n,t){let l=(0,r.useRef)();return l.current||(l.current=e(n,t)),l}:function(t,l){let o=(0,r.useRef)();o.current||(o.current=e(t,l));let i=(0,r.useRef)(t),{instance:u}=o.current;return(0,r.useEffect)(function(){i.current!==t&&(n(u,t,i.current),i.current=t)},[u,t,l]),o}}},3138:(e,n,t)=>{"use strict";t.d(n,{Po:()=>u,gY:()=>i,ko:()=>o});var r=t(5073),l=t(4232);function o(){return(0,r.U$)().map}function i(e,n){let t=o();return(0,l.useEffect)(function(){return t.on(e,n),function(){t.off(e,n)}},[t,e,n]),t}function u(e){let n=o();return(0,l.useEffect)(function(){return n.on(e),function(){n.off(e)}},[n,e]),n}},4986:(e,n,t)=>{"use strict";t.d(n,{T7:()=>d,Nq:()=>p,wk:()=>g,Lt:()=>m,X3:()=>v});var r=t(2349),l=t(723),o=t(2526),i=t(35),u=t(5947),a=t(5073),c=t(1567),s=t(8420),f=t(4232);function d(e){let n=(0,o.K)(function(n,t){return(0,o.Q)(e(n),t)}),t=(0,l.T)(n);return(0,r.KU)(t)}function p(e,n){let t=(0,o.K)(e,n),l=(0,i.V)(t);return(0,r.B7)(l)}function g(e,n){var t;let l=(t=(0,o.K)(e),function(e,r){let l=(0,a.U$)(),o=t((0,s.P)(e,l),l);return(0,u.z)(l.map,e.attribution),(0,c.x)(o.current,e.eventHandlers),n(o.current,l,e,r),o});return(0,r.jU)(l)}function m(e,n){var t;let l=(t=(0,o.K)(e,n),function(e){let n=(0,a.U$)(),r=t((0,s.P)(e,n),n);(0,c.x)(r.current,e.eventHandlers),(0,i.N)(r.current,n);var l=r.current;let o=(0,f.useRef)();return(0,f.useEffect)(function(){if(e.pathOptions!==o.current){let n=e.pathOptions??{};l.instance.setStyle(n),o.current=n}},[l,e]),r});return(0,r.B7)(l)}function v(e,n){let t=(0,o.K)(e,n),l=(0,i.V)(t);return(0,r.KU)(l)}},5073:(e,n,t)=>{"use strict";t.d(n,{U$:()=>a,W4:()=>o,fB:()=>l,hL:()=>u});var r=t(4232);function l(e){return Object.freeze({__version:1,map:e})}function o(e,n){return Object.freeze({...e,...n})}let i=(0,r.createContext)(null),u=i.Provider;function a(){let e=(0,r.useContext)(i);if(null==e)throw Error("No context provided: useLeafletContext() can only be used in a descendant of <MapContainer>");return e}},5947:(e,n,t)=>{"use strict";t.d(n,{z:()=>l});var r=t(4232);function l(e,n){let t=(0,r.useRef)(n);(0,r.useEffect)(function(){n!==t.current&&null!=e.attributionControl&&(null!=t.current&&e.attributionControl.removeAttribution(t.current),null!=n&&e.attributionControl.addAttribution(n)),t.current=n},[e,n])}},6299:(e,n,t)=>{"use strict";t.r(n),t.d(n,{default:()=>x});var r=t(7876),l=t(4232),o=t(8847),i=t(3138),u=t(7152),a=t(1937),c=t(6594),s=t(9458),f=t(1173);t(1782);let d=JSON.parse('{"PolandballNik":"polandball"}');var p=t(9395),g=t(5364);let m=o(()=>t.e(651).then(t.bind(t,1032)).then(e=>e.MapContainer),{loadableGenerated:{webpack:()=>[require.resolveWeak("react-leaflet")]},ssr:!1}),v=o(()=>t.e(651).then(t.bind(t,1032)).then(e=>e.TileLayer),{loadableGenerated:{webpack:()=>[require.resolveWeak("react-leaflet")]},ssr:!1});function h(e){let{pinPoint:n,setPinPoint:t,answerShown:r,dest:o,gameOptions:u,ws:a,multiplayerState:c,playSound:s}=e,f=l.useRef(c),d=l.useRef(a);(0,l.useEffect)(()=>{f.current=c},[c]),(0,l.useEffect)(()=>{d.current=a},[a]);let p=(0,i.Po)({click(e){var n,l,o;let i=f.current,u=d.current;if(!r&&(!(null==i?void 0:i.inGame)||(null==i?void 0:i.inGame)&&!(null==i||null==(l=i.gameData)||null==(n=l.players.find(e=>{var n;return e.id===(null==i||null==(n=i.gameData)?void 0:n.myId)}))?void 0:n.final))){if(t(e.latlng),(null==i?void 0:i.inGame)&&(null==(o=i.gameData)?void 0:o.state)==="guess"&&u){let n=[e.latlng.lat,e.latlng.lng];u.send(JSON.stringify({type:"place",latLong:n,final:!1}))}let n=L.latLngBounds([-90,-180],[90,180]);n.contains(e.latlng)||e.target.panInsideBounds(n,{animate:!0})}}});(0,l.useEffect)(()=>{let e=null==u?void 0:u.extent;p&&!r&&setTimeout(()=>{try{if(e){let n=L.latLngBounds([e[1],e[0]],[e[3],e[2]]);p.fitBounds(n)}else p.setView([30,0],2)}catch(e){}},500)},[(null==u?void 0:u.extent)?JSON.stringify(u.extent):null,p,r]),(0,l.useEffect)(()=>{n&&setTimeout(()=>{try{let e=L.latLngBounds([n,{lat:o.lat,lng:o.long}]).pad(.5);p.flyToBounds(e,{duration:.5})}catch(e){}},300)},[r]),(0,l.useEffect)(()=>{let e=setInterval(()=>{p.invalidateSize()},5);return()=>clearInterval(e)},[p])}let x=e=>{var n,t,o,i;let{shown:x,options:y,ws:b,session:w,pinPoint:E,setPinPoint:j,answerShown:C,location:z,setKm:O,guessing:R,multiplayerSentGuess:k,multiplayerState:P,showHint:T,round:U,focused:I,gameOptions:N}=e,S=l.useRef(null),B=l.useRef(),[A,K]=(0,l.useState)(!1),{t:_}=(0,f.B)("common");(0,l.useEffect)(()=>{let e=()=>{let e="ontouchstart"in window||navigator.maxTouchPoints>0,n=window.innerWidth<=1024;K(e||n)};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]);let H=(0,l.useMemo)(()=>({dest:L.icon({iconUrl:"./dest.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34]}),src:L.icon({iconUrl:"./src.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34]}),src2:L.icon({iconUrl:"./src2.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34]}),polandball:L.icon({iconUrl:"./polandball.png",iconSize:[50,82],iconAnchor:[25,41],popupAnchor:[1,5]})}),[]);(0,l.useEffect)(()=>{if(C&&E&&z){let e=E.distanceTo({lat:z.lat,lng:z.long})/1e3;O(e=e>100?Math.round(e):e>10?parseFloat(e.toFixed(1)):parseFloat(e.toFixed(2)))}},[C,E,z]);let W=L.latLng(-180,-360),M=L.latLng(180,360);return L.latLngBounds(W,M),(0,r.jsxs)(m,{center:[0,0],zoom:2,minZoom:2,style:{height:"100%",width:"100%"},whenCreated:e=>{S.current=e},children:[(0,r.jsx)("div",{className:"mapAttr",children:(0,r.jsx)("img",{width:"60",src:"https://lh3.googleusercontent.com/d_S5gxu_S1P6NR1gXeMthZeBzkrQMHdI5uvXrpn3nfJuXpCjlqhLQKH_hbOxTHxFhp5WugVOEcl4WDrv9rmKBDOMExhKU5KmmLFQVg"})}),(0,r.jsx)(h,{playSound:()=>{B.current.play()},pinPoint:E,setPinPoint:j,answerShown:C,dest:z,gameOptions:N,ws:b,multiplayerState:P}),z&&C&&(0,r.jsx)(u.p,{position:{lat:z.lat,lng:z.long},icon:H.dest}),E&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(u.p,{position:E,icon:"polandball"===d[null==w||null==(n=w.token)?void 0:n.username]?H.polandball:H.src,children:(0,r.jsx)(a.m,{direction:"top",offset:[0,-45],opacity:1,permanent:!0,position:{lat:E.lat,lng:E.lng},children:_("yourGuess")})}),C&&z&&(0,r.jsx)(c.R,{positions:[E,{lat:z.lat,lng:z.long}]})]}),(null==P?void 0:P.inGame)&&C&&z&&(null==P||null==(t=P.gameData)?void 0:t.players.map((e,n)=>{var t;if(e.id===(null==P||null==(t=P.gameData)?void 0:t.myId)||!e.guess)return null;let l=g.env.NEXT_PUBLIC_COOLMATH?(0,p.A)(e.username):e.username,o=[e.guess[0],e.guess[1]],i="polandball"===d[l]?H.polandball:H.src2;return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(u.p,{position:{lat:o[0],lng:o[1]},icon:i,children:(0,r.jsx)(a.m,{direction:"top",offset:[0,-45],opacity:1,permanent:!0,position:{lat:o[0],lng:o[1]},children:(0,r.jsx)("span",{style:{color:"black"},children:l})})},2*n),(0,r.jsx)(c.R,{positions:[{lat:o[0],lng:o[1]},{lat:z.lat,lng:z.long}],color:"green"},2*n+1)]})})),T&&z&&(0,r.jsx)(s.j,{center:{lat:z.lat,lng:z.long},radius:(o=250*(null==N?void 0:N.maxDist),o),className:"hintCircle"}),(0,r.jsx)(v,{noWrap:!0,url:"https://mt{s}.google.com/vt/lyrs=".concat(null!=(i=null==y?void 0:y.mapType)?i:"m","&x={x}&y={y}&z={z}&hl=").concat(_("lang"),"&scale=2"),subdomains:["0","1","2","3"],attribution:'\xa9 <a href="https://maps.google.com">Google</a>',maxZoom:22},A?"mobile":"desktop"),(0,r.jsx)("audio",{ref:B,src:"/plop.mp3",preload:"auto"})]})}},6594:(e,n,t)=>{"use strict";t.d(n,{R:()=>u});var r=t(4986),l=t(2526),o=t(5073),i=t(2133);let u=(0,r.Lt)(function({positions:e,...n},t){let r=new i.Polyline(e,n);return(0,l.Q)(r,(0,o.W4)(t,{overlayContainer:r}))},function(e,n,t){n.positions!==t.positions&&e.setLatLngs(n.positions)})},7152:(e,n,t)=>{"use strict";t.d(n,{p:()=>u});var r=t(4986),l=t(2526),o=t(5073),i=t(2133);let u=(0,r.Nq)(function({position:e,...n},t){let r=new i.Marker(e,n);return(0,l.Q)(r,(0,o.W4)(t,{overlayContainer:r}))},function(e,n,t){n.position!==t.position&&e.setLatLng(n.position),null!=n.icon&&n.icon!==t.icon&&e.setIcon(n.icon),null!=n.zIndexOffset&&n.zIndexOffset!==t.zIndexOffset&&e.setZIndexOffset(n.zIndexOffset),null!=n.opacity&&n.opacity!==t.opacity&&e.setOpacity(n.opacity),null!=e.dragging&&n.draggable!==t.draggable&&(!0===n.draggable?e.dragging.enable():e.dragging.disable())})},8420:(e,n,t)=>{"use strict";function r(e,n){let t=e.pane??n.pane;return t?{...e,pane:t}:e}t.d(n,{P:()=>r})},9458:(e,n,t)=>{"use strict";t.d(n,{j:()=>a});var r=t(4986),l=t(2526),o=t(5073),i=t(9594),u=t(2133);let a=(0,r.Lt)(function({center:e,children:n,...t},r){let i=new u.Circle(e,t);return(0,l.Q)(i,(0,o.W4)(r,{overlayContainer:i}))},i.s)},9594:(e,n,t)=>{"use strict";function r(e,n,t){n.center!==t.center&&e.setLatLng(n.center),null!=n.radius&&n.radius!==t.radius&&e.setRadius(n.radius)}t.d(n,{s:()=>r})}}]);