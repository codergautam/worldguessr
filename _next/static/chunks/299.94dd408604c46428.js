(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[299],{35:(n,t,e)=>{"use strict";e.d(t,{N:()=>i,V:()=>c});var r=e(4232),l=e(5947),o=e(5073),u=e(1567),a=e(8420);function i(n,t){(0,r.useEffect)(function(){return(t.layerContainer??t.map).addLayer(n.instance),function(){t.layerContainer?.removeLayer(n.instance),t.map.removeLayer(n.instance)}},[t,n])}function c(n){return function(t){let e=(0,o.U$)(),r=n((0,a.P)(t,e),e);return(0,l.z)(e.map,t.attribution),(0,u.x)(r.current,t.eventHandlers),i(r.current,e),r}}},723:(n,t,e)=>{"use strict";e.d(t,{T:()=>o});var r=e(4232),l=e(5073);function o(n){return function(t){let e=(0,l.U$)(),o=n(t,e),{instance:u}=o.current,a=(0,r.useRef)(t.position),{position:i}=t;return(0,r.useEffect)(function(){return u.addTo(e.map),function(){u.remove()}},[e.map,u]),(0,r.useEffect)(function(){null!=i&&i!==a.current&&(u.setPosition(i),a.current=i)},[u,i]),o}}},1567:(n,t,e)=>{"use strict";e.d(t,{x:()=>l});var r=e(4232);function l(n,t){let e=(0,r.useRef)();(0,r.useEffect)(function(){return null!=t&&n.instance.on(t),e.current=t,function(){null!=e.current&&n.instance.off(e.current),e.current=null}},[n,t])}},1782:()=>{},1937:(n,t,e)=>{"use strict";e.d(t,{m:()=>a});var r=e(4986),l=e(2526),o=e(2133),u=e(4232);let a=(0,r.wk)(function(n,t){let e=new o.Tooltip(n,t.overlayContainer);return(0,l.Q)(e,t)},function(n,t,{position:e},r){(0,u.useEffect)(function(){let l=t.overlayContainer;if(null==l)return;let{instance:o}=n,u=n=>{n.tooltip===o&&(null!=e&&o.setLatLng(e),o.update(),r(!0))},a=n=>{n.tooltip===o&&r(!1)};return l.on({tooltipopen:u,tooltipclose:a}),l.bindTooltip(o),function(){l.off({tooltipopen:u,tooltipclose:a}),null!=l._map&&l.unbindTooltip()}},[n,t,r,e])})},2349:(n,t,e)=>{"use strict";e.d(t,{B7:()=>u,KU:()=>i,jU:()=>a});var r=e(4232),l=e(8477),o=e(5073);function u(n){return(0,r.forwardRef)(function(t,e){let{instance:l,context:u}=n(t).current;return(0,r.useImperativeHandle)(e,()=>l),null==t.children?null:r.createElement(o.hL,{value:u},t.children)})}function a(n){return(0,r.forwardRef)(function(t,e){let[o,u]=(0,r.useState)(!1),{instance:a}=n(t,u).current;(0,r.useImperativeHandle)(e,()=>a),(0,r.useEffect)(function(){o&&a.update()},[a,o,t.children]);let i=a._contentNode;return i?(0,l.createPortal)(t.children,i):null})}function i(n){return(0,r.forwardRef)(function(t,e){let{instance:l}=n(t).current;return(0,r.useImperativeHandle)(e,()=>l),null})}},2526:(n,t,e)=>{"use strict";e.d(t,{K:()=>o,Q:()=>l});var r=e(4232);function l(n,t,e){return Object.freeze({instance:n,context:t,container:e})}function o(n,t){return null==t?function(t,e){let l=(0,r.useRef)();return l.current||(l.current=n(t,e)),l}:function(e,l){let o=(0,r.useRef)();o.current||(o.current=n(e,l));let u=(0,r.useRef)(e),{instance:a}=o.current;return(0,r.useEffect)(function(){u.current!==e&&(t(a,e,u.current),u.current=e)},[a,e,l]),o}}},3138:(n,t,e)=>{"use strict";e.d(t,{Po:()=>a,gY:()=>u,ko:()=>o});var r=e(5073),l=e(4232);function o(){return(0,r.U$)().map}function u(n,t){let e=o();return(0,l.useEffect)(function(){return e.on(n,t),function(){e.off(n,t)}},[e,n,t]),e}function a(n){let t=o();return(0,l.useEffect)(function(){return t.on(n),function(){t.off(n)}},[t,n]),t}},4986:(n,t,e)=>{"use strict";e.d(t,{T7:()=>d,Nq:()=>p,wk:()=>g,Lt:()=>m,X3:()=>v});var r=e(2349),l=e(723),o=e(2526),u=e(35),a=e(5947),i=e(5073),c=e(1567),s=e(8420),f=e(4232);function d(n){let t=(0,o.K)(function(t,e){return(0,o.Q)(n(t),e)}),e=(0,l.T)(t);return(0,r.KU)(e)}function p(n,t){let e=(0,o.K)(n,t),l=(0,u.V)(e);return(0,r.B7)(l)}function g(n,t){var e;let l=(e=(0,o.K)(n),function(n,r){let l=(0,i.U$)(),o=e((0,s.P)(n,l),l);return(0,a.z)(l.map,n.attribution),(0,c.x)(o.current,n.eventHandlers),t(o.current,l,n,r),o});return(0,r.jU)(l)}function m(n,t){var e;let l=(e=(0,o.K)(n,t),function(n){let t=(0,i.U$)(),r=e((0,s.P)(n,t),t);(0,c.x)(r.current,n.eventHandlers),(0,u.N)(r.current,t);var l=r.current;let o=(0,f.useRef)();return(0,f.useEffect)(function(){if(n.pathOptions!==o.current){let t=n.pathOptions??{};l.instance.setStyle(t),o.current=t}},[l,n]),r});return(0,r.B7)(l)}function v(n,t){let e=(0,o.K)(n,t),l=(0,u.V)(e);return(0,r.KU)(l)}},5073:(n,t,e)=>{"use strict";e.d(t,{U$:()=>i,W4:()=>o,fB:()=>l,hL:()=>a});var r=e(4232);function l(n){return Object.freeze({__version:1,map:n})}function o(n,t){return Object.freeze({...n,...t})}let u=(0,r.createContext)(null),a=u.Provider;function i(){let n=(0,r.useContext)(u);if(null==n)throw Error("No context provided: useLeafletContext() can only be used in a descendant of <MapContainer>");return n}},5947:(n,t,e)=>{"use strict";e.d(t,{z:()=>l});var r=e(4232);function l(n,t){let e=(0,r.useRef)(t);(0,r.useEffect)(function(){t!==e.current&&null!=n.attributionControl&&(null!=e.current&&n.attributionControl.removeAttribution(e.current),null!=t&&n.attributionControl.addAttribution(t)),e.current=t},[n,t])}},6299:(n,t,e)=>{"use strict";e.r(t),e.d(t,{default:()=>w});var r=e(7876),l=e(4232),o=e(8847),u=e(3138),a=e(7152),i=e(1937),c=e(6594),s=e(9458),f=e(1173);e(1782);let d=JSON.parse('{"PolandballNik":"polandball"}');var p=e(9395),g=e(5364);let m=o(()=>e.e(651).then(e.bind(e,1032)).then(n=>n.MapContainer),{loadableGenerated:{webpack:()=>[require.resolveWeak("react-leaflet")]},ssr:!1}),v=o(()=>e.e(651).then(e.bind(e,1032)).then(n=>n.TileLayer),{loadableGenerated:{webpack:()=>[require.resolveWeak("react-leaflet")]},ssr:!1});function h(n,t){var e;let r={lat:n.lat,lng:n.lng},l={lat:t.lat,lng:t.lng},o=(e=r.lng,(l.lng-e+540)%360-180);return l.lng=r.lng+o,[r,l]}function x(n){return[-1,0,1].map(t=>({lat:n.lat,lng:n.lng+360*t}))}function y(n,t){return[-1,0,1].map(e=>h({lat:n.lat,lng:n.lng+360*e},{lat:t.lat,lng:t.lng+360*e}))}function b(n){let{pinPoint:t,setPinPoint:e,answerShown:r,dest:o,gameOptions:a,ws:i,multiplayerState:c,playSound:s}=n,f=l.useRef(c),d=l.useRef(i);(0,l.useEffect)(()=>{f.current=c},[c]),(0,l.useEffect)(()=>{d.current=i},[i]);let p=(0,u.Po)({click(n){var t,l,o;let u=f.current,a=d.current,i=!r&&(!(null==u?void 0:u.inGame)||(null==u?void 0:u.inGame)&&!(null==u||null==(l=u.gameData)||null==(t=l.players.find(n=>{var t;return n.id===(null==u||null==(t=u.gameData)?void 0:t.myId)}))?void 0:t.final));if(p&&i&&(e(n.latlng),(null==u?void 0:u.inGame)&&(null==(o=u.gameData)?void 0:o.state)==="guess"&&a)){let t=[n.latlng.lat,n.latlng.lng];a.send(JSON.stringify({type:"place",latLong:t,final:!1}))}}});return(0,l.useEffect)(()=>{if(!p||r)return;let n=setTimeout(()=>{try{let n=null==a?void 0:a.extent;if(n){let t=L.latLngBounds([n[1],n[0]],[n[3],n[2]]);p.fitBounds(t)}else p.setView([30,0],2)}catch(n){}},500);return()=>clearTimeout(n)},[p,(null==a?void 0:a.extent)?JSON.stringify(a.extent):null,r]),(0,l.useEffect)(()=>{if(!p||!r||!t||!o)return;let n=setTimeout(()=>{try{var n;let[e,r]=h({lat:t.lat,lng:t.lng},{lat:o.lat,lng:null!=(n=o.long)?n:o.lng}),l=Math.min(e.lat,r.lat),u=Math.max(e.lat,r.lat),a=Math.min(e.lng,r.lng),i=Math.max(e.lng,r.lng),c=L.latLngBounds([l,a],[u,i]).pad(.5);p.flyToBounds(c,{duration:.8})}catch(n){}},300);return()=>clearTimeout(n)},[p,r,t,o]),(0,l.useEffect)(()=>{if(!p)return;let n=setInterval(()=>{p.invalidateSize()},500);return()=>clearInterval(n)},[p]),null}let w=n=>{var t,e,o,u,h,w,E,j,z,C;let{shown:O,options:R,ws:T,session:k,pinPoint:P,setPinPoint:S,answerShown:U,location:I,setKm:N,multiplayerState:B,showHint:A,gameOptions:K}=n,M=l.useRef(null),_=l.useRef(),[W,H]=(0,l.useState)(!1),{t:Q}=(0,f.B)("common");(0,l.useEffect)(()=>{let n=()=>{let n="ontouchstart"in window||navigator.maxTouchPoints>0,t=window.innerWidth<=1024;H(n||t)};return n(),window.addEventListener("resize",n),()=>window.removeEventListener("resize",n)},[]);let D=(0,l.useMemo)(()=>({dest:L.icon({iconUrl:"./dest.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34]}),src:L.icon({iconUrl:"./src.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34]}),src2:L.icon({iconUrl:"./src2.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34]}),polandball:L.icon({iconUrl:"./polandball.png",iconSize:[50,82],iconAnchor:[25,41],popupAnchor:[1,5]})}),[]);return(0,l.useEffect)(()=>{if(U&&P&&I){var n;let t=(n=>{var t;return n&&"function"==typeof n.distanceTo?n:L.latLng(n.lat,null!=(t=n.lng)?t:n.long)})(P),e=L.latLng(I.lat,null!=(n=I.long)?n:I.lng),r=t.distanceTo(e)/1e3;N(r=r>100?Math.round(r):r>10?parseFloat(r.toFixed(1)):parseFloat(r.toFixed(2)))}},[U,P,I,N]),(0,r.jsxs)(m,{center:[0,0],zoom:2,minZoom:2,maxBounds:[[-90,-360],[90,360]],maxBoundsViscosity:1,style:{height:"100%",width:"100%"},whenCreated:n=>{M.current=n},children:[(0,r.jsx)("div",{className:"mapAttr",children:(0,r.jsx)("img",{width:"60",src:"https://lh3.googleusercontent.com/d_S5gxu_S1P6NR1gXeMthZeBzkrQMHdI5uvXrpn3nfJuXpCjlqhLQKH_hbOxTHxFhp5WugVOEcl4WDrv9rmKBDOMExhKU5KmmLFQVg"})}),(0,r.jsx)(b,{playSound:()=>{var n;null==(n=_.current)||n.play()},pinPoint:P,setPinPoint:S,answerShown:U,dest:I,gameOptions:K,ws:T,multiplayerState:B}),I&&U&&x({lat:I.lat,lng:null!=(e=I.long)?e:I.lng}).map((n,t)=>(0,r.jsx)(a.p,{position:n,icon:D.dest},"dest-".concat(t))),P&&(0,r.jsxs)(r.Fragment,{children:[x({lat:null!=(o=P.lat)?o:P.lat,lng:null!=(h=null!=(u=P.lng)?u:P.lng)?h:P.long}).map((n,t)=>{var e;return(0,r.jsx)(a.p,{position:n,icon:"polandball"===d[null==k||null==(e=k.token)?void 0:e.username]?D.polandball:D.src,children:(0,r.jsx)(i.m,{direction:"top",offset:[0,-45],opacity:1,permanent:!0,children:Q("yourGuess")})},"mypin-".concat(t))}),U&&I&&y({lat:P.lat,lng:null!=(w=P.lng)?w:P.long},{lat:I.lat,lng:null!=(E=I.long)?E:I.lng}).map((n,t)=>(0,r.jsx)(c.R,{positions:n},"mylink-".concat(t)))]}),(null==B?void 0:B.inGame)&&U&&I&&(null==B||null==(t=B.gameData)?void 0:t.players.map((n,t)=>{var e,o;if(n.id===(null==B||null==(e=B.gameData)?void 0:e.myId)||!n.guess)return null;let u=g.env.NEXT_PUBLIC_COOLMATH?(0,p.A)(n.username):n.username,s={lat:n.guess[0],lng:n.guess[1]},f="polandball"===d[u]?D.polandball:D.src2;return(0,r.jsxs)(l.Fragment,{children:[x(s).map((n,e)=>(0,r.jsx)(a.p,{position:n,icon:f,children:(0,r.jsx)(i.m,{direction:"top",offset:[0,-45],opacity:1,permanent:!0,children:(0,r.jsx)("span",{style:{color:"black"},children:u})})},"player-".concat(t,"-").concat(e))),y(s,{lat:I.lat,lng:null!=(o=I.long)?o:I.lng}).map((n,e)=>(0,r.jsx)(c.R,{positions:n},"pline-".concat(t,"-").concat(e)))]},"player-frag-".concat(t))})),A&&I&&(0,r.jsx)(s.j,{center:{lat:I.lat,lng:null!=(j=I.long)?j:I.lng},radius:250*(null!=(z=null==K?void 0:K.maxDist)?z:0)}),(0,r.jsx)(v,{noWrap:!1,continuousWorld:!0,url:"https://mt{s}.google.com/vt/lyrs=".concat(null!=(C=null==R?void 0:R.mapType)?C:"m","&x={x}&y={y}&z={z}&hl=").concat(Q("lang"),"&scale=2"),subdomains:["0","1","2","3"],attribution:'\xa9 <a href="https://maps.google.com">Google</a>',maxZoom:22,tileSize:W?512:256,zoomOffset:W?-1:0,detectRetina:!0},W?"mobile":"desktop"),(0,r.jsx)("audio",{ref:_,src:"/plop.mp3",preload:"auto"})]})}},6594:(n,t,e)=>{"use strict";e.d(t,{R:()=>a});var r=e(4986),l=e(2526),o=e(5073),u=e(2133);let a=(0,r.Lt)(function({positions:n,...t},e){let r=new u.Polyline(n,t);return(0,l.Q)(r,(0,o.W4)(e,{overlayContainer:r}))},function(n,t,e){t.positions!==e.positions&&n.setLatLngs(t.positions)})},7152:(n,t,e)=>{"use strict";e.d(t,{p:()=>a});var r=e(4986),l=e(2526),o=e(5073),u=e(2133);let a=(0,r.Nq)(function({position:n,...t},e){let r=new u.Marker(n,t);return(0,l.Q)(r,(0,o.W4)(e,{overlayContainer:r}))},function(n,t,e){t.position!==e.position&&n.setLatLng(t.position),null!=t.icon&&t.icon!==e.icon&&n.setIcon(t.icon),null!=t.zIndexOffset&&t.zIndexOffset!==e.zIndexOffset&&n.setZIndexOffset(t.zIndexOffset),null!=t.opacity&&t.opacity!==e.opacity&&n.setOpacity(t.opacity),null!=n.dragging&&t.draggable!==e.draggable&&(!0===t.draggable?n.dragging.enable():n.dragging.disable())})},8420:(n,t,e)=>{"use strict";function r(n,t){let e=n.pane??t.pane;return e?{...n,pane:e}:n}e.d(t,{P:()=>r})},9458:(n,t,e)=>{"use strict";e.d(t,{j:()=>i});var r=e(4986),l=e(2526),o=e(5073),u=e(9594),a=e(2133);let i=(0,r.Lt)(function({center:n,children:t,...e},r){let u=new a.Circle(n,e);return(0,l.Q)(u,(0,o.W4)(r,{overlayContainer:u}))},u.s)},9594:(n,t,e)=>{"use strict";function r(n,t,e){t.center!==e.center&&n.setLatLng(t.center),null!=t.radius&&t.radius!==e.radius&&n.setRadius(t.radius)}e.d(t,{s:()=>r})}}]);