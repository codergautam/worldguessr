"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[55],{409:(e,t,n)=>{n.d(t,{A:()=>o});function o(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=window;try{n.gtag("event",e,t)}catch(e){console.log("error sending gtag event",e)}}},858:(e,t,n)=>{n.d(t,{W:()=>l,a:()=>r});let o=[];function r(){try{return window.self!==window.top}catch(e){return!0}}function l(){try{return r()&&o.some(e=>{var t,n,o;return(null!=(o=null==(n=window)||null==(t=n.location)?void 0:t.ancestorOrigins[0])?o:document.referrer).includes(e)})}catch(e){return console.error("Piracy detection error",e),!1}}},1213:(e,t,n)=>{n.d(t,{A:()=>p});var o=n(7876),r=n(3679),l=n(4679),a=n(6336),s=n(1173),i=n(409),c=n(4279);function u(e){var t,n,l,u,d,g,m;let{session:h,openAccountModal:p,navbarMode:f,inCrazyGames:w}=e,{t:x}=(0,s.B)("common"),v=(null==h||null==(t=h.token)?void 0:t.countryCode)||null;return!w||h&&(null==h||null==(n=h.token)?void 0:n.secret)?(0,o.jsx)(o.Fragment,{children:h&&(null==h||null==(l=h.token)?void 0:l.secret)?(0,o.jsx)("button",{className:"gameBtn ".concat(f?"navBtn":"accountBtn loggedIn"," ").concat((null==h||null==(d=h.token)?void 0:d.supporter)?"supporterBtn":""),onClick:()=>{p()},children:(null==h||null==(g=h.token)?void 0:g.username)?(0,o.jsxs)("p",{style:{color:"white",paddingRight:"-13px",marginLeft:"0px",fontSize:"1.4em",fontWeight:700,display:"flex",alignItems:"center",gap:"6px"},children:[null==h||null==(m=h.token)?void 0:m.username,v&&(0,o.jsx)(c.A,{countryCode:v,style:{fontSize:"1em"}})]}):null}):(0,o.jsx)("button",{className:"gameBtn ".concat(f?"navBtn":"accountBtn"),disabled:w,onClick:()=>{null===h&&((0,i.A)("login_attempt"),(0,a.Jv)("google"))},children:(null==h||null==(u=h.token)?void 0:u.secret)||null===h?(0,o.jsx)("div",{style:{marginRight:"10px",marginLeft:"10px",display:"flex",alignItems:"center",justifyContent:"center"},children:w?(0,o.jsx)(o.Fragment,{children:"..."}):(0,o.jsxs)(o.Fragment,{children:[x("login"),"\xa0\xa0",(0,o.jsx)(r.DSS,{className:"home__squarebtnicon"})]})}):"..."})}):null}var d=n(6059),g=n(4250),m=n(4232);function h(e){let{connected:t,shown:n,onClick:r,connecting:l}=e,[a,s]=(0,m.useState)(!1),[i,c]=(0,m.useState)(!1),[u,h]=(0,m.useState)(!1),p=(0,m.useRef)(t),f=(0,m.useRef)(l),w=(0,m.useRef)(null),x=(0,m.useRef)(null),v=(0,m.useRef)(null);if((0,m.useEffect)(()=>{let e=p.current,n=f.current;(w.current&&(clearTimeout(w.current),w.current=null),x.current&&(clearTimeout(x.current),x.current=null),l)?n?(v.current?Date.now()-v.current:0)>=3e3&&(s(!0),c(!1),h(!1)):(v.current=Date.now(),s(!1),c(!1),h(!1),x.current=setTimeout(()=>{s(!0),c(!1),h(!0),setTimeout(()=>h(!1),400)},3e3)):t?t&&!e?(v.current?Date.now()-v.current:0)>=3e3?(s(!0),c(!1),h(!1),w.current=setTimeout(()=>{c(!0),setTimeout(()=>{s(!1),c(!1)},400)},1500)):(s(!1),c(!1),h(!1)):t&&(s(!1),c(!1),h(!1)):(s(!0),c(!1),h(!0),setTimeout(()=>h(!1),400)),p.current=t,f.current=l},[t,l]),(0,m.useEffect)(()=>()=>{w.current&&clearTimeout(w.current),x.current&&clearTimeout(x.current)},[]),!n||!a)return null;let b=()=>t?"#22c55e":l?"#f59e0b":"#ef4444";return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(g,{id:"a7d97ecb79e7aa48",children:"@keyframes pulse-connect{0%,100%{transform:scale(1);box-shadow:0 4px 16px rgba(0,0,0,.4)}50%{transform:scale(1.05);box-shadow:0 6px 20px rgba(245,158,11,.6)}}@keyframes pulse-disconnect{0%,100%{box-shadow:0 4px 16px rgba(0,0,0,.4)}50%{box-shadow:0 6px 20px rgba(239,68,68,.6)}}"}),(0,o.jsx)("div",{onClick:r,style:{position:"fixed",top:"100px",right:i||u?"-85px":"15px",zIndex:1e4,width:"50px",height:"50px",borderRadius:"15px",backgroundColor:"rgba(0, 0, 0, 0.8)",backdropFilter:"blur(10px)",display:"flex",alignItems:"center",justifyContent:"center",cursor:r?"pointer":"default",boxShadow:"0 4px 16px rgba(0,0,0,0.4)",transition:"right 0.4s ease-in-out, transform 0.4s ease-in-out, all 0.3s ease",border:"3px solid ".concat(b()),pointerEvents:"auto",animation:i||u?"none":l?"pulse-connect 1s ease-in-out infinite":t?"none":"pulse-disconnect 2s ease-in-out infinite",transform:u?"translateX(100px)":"translateX(0)"},onMouseEnter:e=>{l||(e.target.style.transform="scale(1.1)",e.target.style.boxShadow="0 6px 20px rgba(0,0,0,0.5)")},onMouseLeave:e=>{l||(e.target.style.transform="scale(1)",e.target.style.boxShadow="0 4px 16px rgba(0,0,0,0.4)")},title:t?"Connected to server":l?"Connecting to server...":"Connection lost - Click for details",className:"jsx-a7d97ecb79e7aa48",children:(0,o.jsx)(d._8$,{size:28,color:b()})})]})}function p(e){var t,n,a,i;let{maintenance:c,joinCodePress:g,inCrazyGames:p,inCoolMathGames:f,inGame:w,openAccountModal:x,shown:v,backBtnPressed:b,reloadBtnPressed:y,setGameOptionsModalShown:k,onNavbarPress:j,onFriendsPress:C,gameOptions:S,session:_,screen:A,multiplayerState:R,loading:B,gameOptionsModalShown:N,accountModalOpen:T,selectCountryModalShown:F,mapModalOpen:I,onConnectionError:D}=e,{t:M}=(0,s.B)("common"),z=((null==R?void 0:R.inGame)||"singleplayer"===A)&&!B&&!((null==R?void 0:R.inGame)&&(null==R||null==(t=R.gameData)?void 0:t.state)==="waiting"),[E,G]=(0,m.useState)(!0);return(0,m.useEffect)(()=>{window.location.search.includes("app=true")&&G(!1)},[]),(0,o.jsx)(o.Fragment,{children:(0,o.jsxs)("div",{className:"navbar ".concat(v?"":"hidden"," ").concat("home"==A?"":"navbarColor"," ").concat("onboarding"===A?"onboarding":""),children:[(0,o.jsxs)("div",{className:"nonHome ".concat("home"===A?"":"shown"),children:[!I&&(0,o.jsx)("h1",{className:"navbar__title desktop",onClick:j,children:"WorldGuessr"}),!I&&(0,o.jsx)("h1",{className:"navbar__title mobile",onClick:j,children:"WG"}),!N&&!T&&!F&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("button",{className:"gameBtn navBtn backBtn ".concat("onboarding"===A?"g2_blue_button":"g2_red_button"," desktop"),onClick:b,children:M("onboarding"===A?"menu":"back")}),(0,o.jsx)("button",{className:"gameBtn navBtn backBtn ".concat("onboarding"===A?"g2_blue_button":"g2_red_button"," mobile"),onClick:b,children:(0,o.jsx)(r.QVr,{})})]})]}),z&&!T&&!N&&(0,o.jsx)("button",{className:"gameBtn navBtn backBtn reloadBtn g2_blue_button",onClick:y,children:(0,o.jsx)("img",{src:"/return.png",alt:"reload",height:13,style:{filter:"invert(1)",transform:"scale(1.5)"}})}),(0,o.jsx)(h,{connected:null==R?void 0:R.connected,connecting:null==R?void 0:R.connecting,shown:!0,onClick:(null==R?void 0:R.connected)?void 0:D}),"multiplayer"===A&&(null==R?void 0:R.inGame)&&(null==R||null==(n=R.gameData)?void 0:n.players.length)>0&&(0,o.jsxs)("span",{id:"playerCnt",className:"bigSpan",children:["\xa0 ",(0,o.jsx)(r.x$1,{})," ",R.gameData.players.length]}),(0,o.jsxs)("div",{className:"navbar__right",children:["singleplayer"===A&&!T&&(0,o.jsxs)("button",{className:"gameBtn navBtn g2_green_button g2_lexend",disabled:B,onClick:()=>k(!0),children:["all"!==S.location&&S.location?(null==S?void 0:S.countryMap)?(0,l.A)(S.location):null==S?void 0:S.communityMapName:M("allCountries"),S.nm&&S.npz?", NMPZ":S.nm?", NM":S.npz?", NPZ":"","\xa0",(0,o.jsx)(d.dgZ,{size:20})]}),"onboarding"===A&&(0,o.jsx)("button",{className:"gameBtn navBtn",style:{backgroundColor:"blue"},onClick:g,children:M("joinGame")}),!w&&E&&!f&&!T&&!I&&(0,o.jsx)(u,{inCrazyGames:p,session:_,navbarMode:"home"!==A,openAccountModal:x}),(null==_||null==(a=_.token)?void 0:a.secret)&&!T&&!N&&!I&&!["getready","guess"].includes(null==R||null==(i=R.gameData)?void 0:i.state)&&(0,o.jsx)("button",{className:"gameBtn friendBtn ".concat("home"===A?"friendBtnFixed":""),onClick:C,disabled:!(null==R?void 0:R.connected),children:(0,o.jsx)(r.M5n,{size:40,className:"friendBtnIcon ".concat("home"===A?"friendBtnIconFixed":"")})})]})]})})}},3603:(e,t,n)=>{n.d(t,{A:()=>o});function o(){var e;let t=!window||"https:"===window.location.protocol;return{apiUrl:(t?"https":"http")+"://api.worldguessr.com",websocketUrl:(t?"wss":"ws")+"://"+((e="server.worldguessr.com",void 0!==e)?e:"localhost:3002")+"/wg"}}},4279:(e,t,n)=>{n.d(t,{A:()=>r});var o=n(7876);function r(e){let{countryCode:t,style:n={},size:r=1}=e;if(!t||""===t||"string"!=typeof t||2!==t.length)return null;let l=t.toLowerCase();return(0,o.jsx)("img",{src:"https://flagcdn.com/w80/".concat(l,".png"),srcSet:"".concat("https://flagcdn.com/w160/".concat(l,".png")," 2x"),alt:t,title:t,style:{display:"inline-block",width:"".concat(1.5*r,"em"),height:"".concat(r,"em"),marginRight:"0.4em",verticalAlign:"middle",flexShrink:0,objectFit:"cover",borderRadius:"2px",...n}})}},4679:(e,t,n)=>{n.d(t,{A:()=>l});var o=n(6107);let r={GB:"United Kingdom",US:"United States",RU:"Russia",KR:"South Korea",TW:"Taiwan"};function l(e){var t;return null!=(t=r[e])?t:o.JJ(e)}},6336:(e,t,n)=>{n.d(t,{CI:()=>a,Jv:()=>s,dJ:()=>c,wV:()=>i});var o=n(858);n(2446);var r=n(8207);let l=!1;function a(){window.localStorage.removeItem("wg_secret"),l=null,window.dontReconnect||(console.log("Removing cookies"),function(){for(var e=document.cookie.split("; "),t=0;t<e.length;t++)for(var n=window.location.hostname.split(".");n.length>0;){var o=encodeURIComponent(e[t].split(";")[0].split("=")[0])+"=; expires=Thu, 01-Jan-1970 00:00:01 GMT; domain="+n.join(".")+" ;path=",r=location.pathname.split("/");for(document.cookie=o+"/";r.length>0;)document.cookie=o+r.join("/"),console.log(o+r.join("/")),r.pop();n.shift()}}(),window.location.reload())}function s(){if(console.log("Signing in"),(0,o.a)()){console.log("In iframe");let e=window.location.href;window.open(e,"_blank")}window.login()}function i(){var e,t;if(window.location.hostname.includes("crazygames")&&window.verifyPayload&&"not_logged_in"===JSON.parse(window.verifyPayload).secret)return{data:null};if(!1===l&&!window.fetchingSession&&(null==(e=window.cConfig)?void 0:e.apiUrl)){let e=null;try{e=window.localStorage.getItem("wg_secret")}catch(e){console.error(e)}e?(window.fetchingSession=!0,console.log("[Auth] Starting authentication with retry mechanism (5s timeout, unlimited retries)"),r.A.fetchWithRetry((null==(t=window.cConfig)?void 0:t.apiUrl)+"/api/googleAuth",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({secret:e})},"googleAuth",{timeout:5e3,maxRetries:1/0,baseDelay:1e3,maxDelay:1e4}).then(e=>e.json()).then(e=>{if(window.fetchingSession=!1,console.log("[Auth] Authentication successful"),e.error){console.error("[Auth] Server error:",e.error),l=null;return}e.secret?(window.localStorage.setItem("wg_secret",e.secret),l={token:e},console.log("[Auth] Session established for user:",e.username)):(console.log("[Auth] No session data received, user not logged in"),l=null)}).catch(e=>{window.fetchingSession=!1,console.error("[Auth] Authentication failed:",e.message);try{window.localStorage.removeItem("wg_secret")}catch(e){console.warn("[Auth] Could not clear localStorage:",e)}l=null})):l=null}return{data:l}}function c(){var e;let t=null;if(l&&(null==l||null==(e=l.token)?void 0:e.secret))t=l.secret;else try{t=window.localStorage.getItem("wg_secret")}catch(e){console.error(e)}return t?{Authorization:"Bearer "+t}:{}}},8207:(e,t,n)=>{n.d(t,{A:()=>r});class o{async fetchWithRetry(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},{timeout:r=1e4,maxRetries:l=this.maxRetries,baseDelay:a=this.baseDelay,maxDelay:s=this.maxDelay}=o,i=l===1/0?1e3:l,c=this.retryAttempts.get(n)||0;console.log("[RetryFetch] Attempting ".concat(n," (attempt ").concat(c+1,"/").concat(l===1/0?"âˆž":i+1,")"));let u=new AbortController,d=setTimeout(()=>u.abort(),r);try{let o=await fetch(e,{...t,signal:u.signal});if(clearTimeout(d),!o.ok)throw Error("HTTP ".concat(o.status,": ").concat(o.statusText));return this.retryAttempts.delete(n),console.log("[RetryFetch] Success for ".concat(n)),o}catch(r){if(clearTimeout(d),console.warn("[RetryFetch] Error for ".concat(n,":"),r.message),c<i&&this.shouldRetry(r)){let r=Math.min(a*Math.pow(2,c),s);return console.log("[RetryFetch] Retrying ".concat(n," in ").concat(r,"ms...")),this.retryAttempts.set(n,c+1),new Promise((l,a)=>{setTimeout(()=>{this.fetchWithRetry(e,t,n,o).then(l).catch(a)},r)})}throw console.error("[RetryFetch] Failed ".concat(n," after ").concat(c+1," attempts:"),r.message),this.retryAttempts.delete(n),r}}shouldRetry(e){return"AbortError"===e.name||"TypeError"===e.name||e.message&&e.message.includes("fetch")||e.message&&e.message.includes("HTTP 5")}resetRetries(e){this.retryAttempts.delete(e),console.log("[RetryFetch] Reset retry count for ".concat(e))}getRetryCount(e){return this.retryAttempts.get(e)||0}constructor(){this.retryAttempts=new Map,this.maxRetries=5,this.baseDelay=1e3,this.maxDelay=3e4}}let r=new o}}]);