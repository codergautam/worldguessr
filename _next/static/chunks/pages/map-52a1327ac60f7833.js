(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[890],{858:(e,t,a)=>{"use strict";a.d(t,{W:()=>r,a:()=>o});let n=[];function o(){try{return window.self!==window.top}catch(e){return!0}}function r(){try{return o()&&n.some(e=>{var t,a,n;return(null!=(n=null==(a=window)||null==(t=a.location)?void 0:t.ancestorOrigins[0])?n:document.referrer).includes(e)})}catch(e){return console.error("Piracy detection error",e),!1}}},6336:(e,t,a)=>{"use strict";a.d(t,{CI:()=>i,Jv:()=>c,dJ:()=>d,wV:()=>l});var n=a(858),o=a(2446),r=a(8207);let s=!1;function i(){window.localStorage.removeItem("wg_secret"),s=null,window.dontReconnect||(console.log("Removing cookies"),function(){for(var e=document.cookie.split("; "),t=0;t<e.length;t++)for(var a=window.location.hostname.split(".");a.length>0;){var n=encodeURIComponent(e[t].split(";")[0].split("=")[0])+"=; expires=Thu, 01-Jan-1970 00:00:01 GMT; domain="+a.join(".")+" ;path=",o=location.pathname.split("/");for(document.cookie=n+"/";o.length>0;)document.cookie=n+o.join("/"),console.log(n+o.join("/")),o.pop();a.shift()}}(),window.location.reload())}function c(){if(console.log("Signing in"),(0,n.a)()){console.log("In iframe");let e=window.location.href;window.open(e,"_blank")}window.login()}function l(){var e,t;if(window.location.hostname.includes("crazygames")&&window.verifyPayload&&"not_logged_in"===JSON.parse(window.verifyPayload).secret)return{data:null};if(!1===s&&!window.fetchingSession&&(null==(e=window.cConfig)?void 0:e.apiUrl)){let e=null;try{e=window.localStorage.getItem("wg_secret")}catch(e){console.error(e)}e?(window.fetchingSession=!0,console.log("[Auth] Starting authentication with retry mechanism"),r.A.fetchWithRetry((null==(t=window.cConfig)?void 0:t.apiUrl)+"/api/googleAuth",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({secret:e})},"googleAuth").then(e=>e.json()).then(e=>{if(window.fetchingSession=!1,console.log("[Auth] Authentication successful"),e.error){console.error("[Auth] Server error:",e.error),s=null;return}e.secret?(window.localStorage.setItem("wg_secret",e.secret),s={token:e},console.log("[Auth] Session established for user:",e.username)):(console.log("[Auth] No session data received, user not logged in"),s=null)}).catch(e=>{window.fetchingSession=!1,console.error("[Auth] Authentication failed after all retries:",e.message);try{window.localStorage.removeItem("wg_secret")}catch(e){console.warn("[Auth] Could not clear localStorage:",e)}s=null,r.A.getRetryCount("googleAuth")>=5&&o.oR.error("Connection issues detected. Please refresh the page if problems persist.")})):s=null}return{data:s}}function d(){var e;let t=null;if(s&&(null==s||null==(e=s.token)?void 0:e.secret))t=s.secret;else try{t=window.localStorage.getItem("wg_secret")}catch(e){console.error(e)}return t?{Authorization:"Bearer "+t}:{}}},7623:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>m});var n=a(7876),o=a(4232),r=a(7328),s=a(9099),i=a(7703),c=a(1213),l=a(1173),d=a(3603),u=a(6336);function m(e){var t;let{}=e,a=(0,s.useRouter)(),[m,h]=(0,o.useState)(0),[g,p]=(0,o.useState)([]),[w,f]=(0,o.useState)(i.iframe),{t:_}=(0,l.B)("common"),[y,x]=(0,o.useState)({});(0,o.useRef)(null),(0,o.useRef)(null),(0,o.useRef)([]),(0,o.useRef)(null);let[v,j]=(0,o.useState)(0);return(0,o.useEffect)(()=>{var e;let{apiUrl:t}=(0,d.A)(),n=new URLSearchParams(window.location.search),o=a.query.s||a.query.slug||n.get("s")||n.get("slug");console.log("also can be the format /map/slug");let r=window.location.pathname;r.startsWith("/map/")&&!o&&(o=r.split("/map/")[1]),o&&(console.log("fetching map data for",o,(0,u.dJ)()),fetch(t+"/api/map/publicData?slug=".concat(o),{headers:{authorization:null==(e=(0,u.dJ)())?void 0:e.authorization}}).then(async e=>{if(e.ok){let t=await e.json();console.log("fetched map data:",t),x(t.mapData)}else console.error("Failed to fetch map data:",e),404===e.status&&a.push("/404")}).catch(e=>{alert("An error occurred while fetching map data")}))},[]),(0,o.useEffect)(()=>{if(!y.data)return;let e=y.data.map(e=>"//www.google.com/maps/embed/v1/streetview?key=AIzaSyA2fHNuyc768n9ZJLTrfbkWLNK3sLOK-iQ&location=".concat(e.lat,",").concat(e.lng,"&fov=60"));p(e);let t=setInterval(()=>{f(i.iframe+" "+i.fadeOut),setTimeout(()=>{h(Math.floor(Math.random()*e.length)),f(i.iframe+" "+i.fadeIn)},1e3)},5e3);return window.intervalId=t,()=>clearInterval(t)},[y.data]),(0,n.jsxs)("div",{className:i.container,children:[(0,n.jsxs)(r,{children:[(0,n.jsx)("title",{children:(null==y?void 0:y.name)?"".concat(y.name," - WorldGuessr"):""}),(0,n.jsx)("meta",{name:"description",content:"Explore the world on WorldGuessr, a free GeoGuessr alternative. "}),(0,n.jsx)("link",{rel:"icon",type:"image/x-icon",href:"/icon.ico"}),(0,n.jsx)("meta",{name:"viewport",content:"width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"})]}),(0,n.jsx)("style",{children:"\n          .mainBody {\n            user-select: auto !important;\n            overflow: auto !important;\n          }\n\n          .custom-marker {\n            background: none !important;\n            border: none !important;\n          }\n\n          .custom-marker div:hover {\n            transform: scale(1.2);\n          }\n\n          .marker-cluster {\n            background-color: rgba(255, 255, 255, 0.8);\n            border: 2px solid #4CAF50;\n            border-radius: 50%;\n            text-align: center;\n            font-size: 12px;\n            font-weight: bold;\n            line-height: 36px;\n            color: #333;\n            cursor: pointer;\n          }\n\n          .marker-cluster-small {\n            background-color: rgba(76, 175, 80, 0.8);\n            color: white;\n          }\n\n          .marker-cluster-medium {\n            background-color: rgba(255, 152, 0, 0.8);\n            color: white;\n          }\n\n          .marker-cluster-large {\n            background-color: rgba(244, 67, 54, 0.8);\n            color: white;\n          }\n\n          .marker-cluster div {\n            width: 36px;\n            height: 36px;\n            margin-left: 2px;\n            margin-top: 2px;\n            border-radius: 50%;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n          }\n        "}),(0,n.jsxs)("main",{className:i.main,children:[(0,n.jsx)(c.A,{}),(null==y?void 0:y.name)&&(0,n.jsxs)(n.Fragment,{children:[y.in_review&&(0,n.jsx)("div",{className:i.statusMessage,children:(0,n.jsx)("p",{children:"⏳ This map is currently under review."})}),y.reject_reason&&(0,n.jsx)("div",{className:i.statusMessage,children:(0,n.jsxs)("p",{children:["❌ This map has been rejected: ",y.reject_reason]})})]}),(0,n.jsxs)("div",{className:i.branding,children:[(0,n.jsx)("h1",{children:"WorldGuessr"}),(0,n.jsx)("center",{children:(0,n.jsxs)("button",{onClick:()=>window.location.href="/".concat(window.location.search.includes("crazygames")?"?crazygames=true":""),className:i.backButton,children:["← ",_("backToGame")]})})]}),y.name&&(0,n.jsxs)("div",{className:i.mapHeader,children:[(0,n.jsxs)("div",{className:i.mapImage,children:[g.length>0&&(0,n.jsx)("div",{className:i.iframeContainer,children:(0,n.jsx)("iframe",{className:w,loading:"lazy",allowFullScreen:!0,referrerPolicy:"no-referrer-when-downgrade",src:g[m]})}),y.countryCode&&(0,n.jsx)("img",{src:"https://flagcdn.com/w2560/".concat(null==(t=y.countryCode)?void 0:t.toLowerCase(),".png"),style:{width:"100%",height:"100%",objectFit:"cover"}})]}),(0,n.jsxs)("div",{className:i.mapInfo,children:[(0,n.jsx)("h1",{children:y.name}),(0,n.jsx)("p",{children:y.description_short})]})]}),(null==y?void 0:y.name)&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("button",{className:i.playButton,onClick:()=>{window.location.href="/?map=".concat(y.countryCode||y.slug).concat(window.location.search.includes("crazygames")?"&crazygames=true":"")},children:"PLAY"}),(0,n.jsxs)("div",{className:i.mapStats,children:[void 0!==y.plays&&(0,n.jsxs)("div",{className:i.stat,children:[(0,n.jsx)("span",{className:i.statIcon,children:"\uD83D\uDC65"}),(0,n.jsx)("span",{className:i.statValue,children:y.plays.toLocaleString()}),(0,n.jsx)("span",{className:i.statLabel,children:"Plays"})]}),y.data&&(0,n.jsxs)("div",{className:i.stat,children:[(0,n.jsx)("span",{className:i.statIcon,children:"\uD83D\uDCCD"}),(0,n.jsx)("span",{className:i.statValue,children:y.locationcnt.toLocaleString()}),(0,n.jsx)("span",{className:i.statLabel,children:"Locations"})]}),void 0!==y.hearts&&(0,n.jsxs)("div",{className:i.stat,children:[(0,n.jsx)("span",{className:i.statIcon,children:"❤️"}),(0,n.jsx)("span",{className:i.statValue,children:y.hearts.toLocaleString()}),(0,n.jsx)("span",{className:i.statLabel,children:"Hearts"})]})]}),(0,n.jsxs)("div",{className:i.mapDescription,children:[(0,n.jsx)("h2",{children:"About this map"}),y.description_long.split("\n").map((e,t)=>(0,n.jsx)("p",{children:e},t)),(0,n.jsxs)("p",{className:i.mapAuthor,children:["Created by ",(0,n.jsx)("strong",{children:y.created_by}),y.created_at&&" ".concat(y.created_at," ago")]})]})]})]})]})}a(2446)},7703:e=>{e.exports={container:"MapPage_container__xYWXo",main:"MapPage_main__9rDnn",branding:"MapPage_branding__HuPlP",backButton:"MapPage_backButton__hUtxm",statusMessage:"MapPage_statusMessage__gBAeq",mapHeader:"MapPage_mapHeader__3oQ9O",mapImage:"MapPage_mapImage__enP0P",iframeContainer:"MapPage_iframeContainer__qN9dy",iframe:"MapPage_iframe__EmsgL",fadeOut:"MapPage_fadeOut__I3Vau",fadeIn:"MapPage_fadeIn__4GKks",mapInfo:"MapPage_mapInfo__GI_qE",playButton:"MapPage_playButton__A22gH",worldMapSection:"MapPage_worldMapSection__PwwOU",worldMapContainer:"MapPage_worldMapContainer__xaRiW",mapStats:"MapPage_mapStats__q55sE",stat:"MapPage_stat__sxArn",statIcon:"MapPage_statIcon__KuDGT",statValue:"MapPage_statValue__F1uP_",statLabel:"MapPage_statLabel__9e1yA",mapDescription:"MapPage_mapDescription__ymrug",mapAuthor:"MapPage_mapAuthor__oups6",pageSlideIn:"MapPage_pageSlideIn__42_WF"}},8032:(e,t,a)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/map",function(){return a(7623)}])},8207:(e,t,a)=>{"use strict";a.d(t,{A:()=>o});class n{async fetchWithRetry(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e,n=this.retryAttempts.get(a)||0;console.log("[RetryFetch] Attempting ".concat(a," (attempt ").concat(n+1,"/").concat(this.maxRetries+1,")"));try{let n=new AbortController,o=setTimeout(()=>n.abort(),1e4),r=await fetch(e,{...t,signal:n.signal});if(clearTimeout(o),!r.ok)throw Error("HTTP ".concat(r.status,": ").concat(r.statusText));return this.retryAttempts.delete(a),console.log("[RetryFetch] Success for ".concat(a)),r}catch(o){if(console.warn("[RetryFetch] Error for ".concat(a,":"),o.message),n<this.maxRetries&&this.shouldRetry(o)){let o=Math.min(this.baseDelay*Math.pow(2,n),this.maxDelay);return console.log("[RetryFetch] Retrying ".concat(a," in ").concat(o,"ms...")),this.retryAttempts.set(a,n+1),new Promise(n=>{setTimeout(()=>{n(this.fetchWithRetry(e,t,a))},o)})}throw console.error("[RetryFetch] Failed ".concat(a," after ").concat(n+1," attempts:"),o.message),this.retryAttempts.delete(a),o}}shouldRetry(e){return"AbortError"===e.name||"TypeError"===e.name||e.message&&e.message.includes("fetch")||e.message&&e.message.includes("HTTP 5")}resetRetries(e){this.retryAttempts.delete(e),console.log("[RetryFetch] Reset retry count for ".concat(e))}getRetryCount(e){return this.retryAttempts.get(e)||0}constructor(){this.retryAttempts=new Map,this.maxRetries=5,this.baseDelay=1e3,this.maxDelay=3e4}}let o=new n}},e=>{e.O(0,[938,585,535,833,479,213,636,593,792],()=>e(e.s=8032)),_N_E=e.O()}]);