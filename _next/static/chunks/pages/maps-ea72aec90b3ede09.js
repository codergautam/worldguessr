(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[869],{420:(e,t,o)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/maps",function(){return o(4972)}])},858:(e,t,o)=>{"use strict";o.d(t,{W:()=>s,a:()=>r});let n=[];function r(){try{return window.self!==window.top}catch(e){return!0}}function s(){try{return r()&&n.some(e=>{var t,o,n;return(null!=(n=null==(o=window)||null==(t=o.location)?void 0:t.ancestorOrigins[0])?n:document.referrer).includes(e)})}catch(e){return console.error("Piracy detection error",e),!1}}},3603:(e,t,o)=>{"use strict";function n(){var e;let t=!window||"https:"===window.location.protocol;return{apiUrl:(t?"https":"http")+"://api.worldguessr.com",websocketUrl:(t?"wss":"ws")+"://"+((e="server.worldguessr.com",void 0!==e)?e:"localhost:3002")+"/wg"}}o.d(t,{A:()=>n})},4972:(e,t,o)=>{"use strict";o.r(t),o.d(t,{default:()=>d});var n=o(7876),r=o(4232),s=o(9099),i=o(9701),a=o(1173),c=o(3603),l=o(6336),u=o(7328);let h={open:!1,progress:!1,name:"",description_short:"",description_long:"",data:"",edit:!1,mapId:""};function d(e){let{}=e,t=(0,s.useRouter)(),{t:o}=(0,a.B)("common"),{data:d,status:w}=(0,l.wV)(),[m,p]=(0,r.useState)(h),[f,y]=(0,r.useState)(""),[v,A]=(0,r.useState)([]);return(0,r.useEffect)(()=>{window.cConfig=(0,c.A)()},[]),(0,n.jsxs)("div",{style:g.pageContainer,children:[(0,n.jsx)(u,{children:(0,n.jsx)("link",{href:"https://fonts.googleapis.com/css2?family=Jockey+One&display=swap",rel:"stylesheet"})}),(0,n.jsx)("div",{style:g.pageContent,children:(0,n.jsx)(i.A,{showOptions:!1,showAllCountriesOption:!1,chosenMap:void 0,close:()=>t.back(),session:d,text:o,onMapClick:e=>{t.push("/map?s=".concat(e.slug))},gameOptions:void 0,setGameOptions:void 0,makeMap:m,setMakeMap:p,initMakeMap:h,searchTerm:f,setSearchTerm:y,searchResults:v,setSearchResults:A})})]})}let g={pageContainer:{width:"100vw",height:"100vh",display:"flex",justifyContent:"center",alignItems:"center",background:"linear-gradient(135deg, rgba(0, 0, 0, 0.98) 0%, rgba(0, 10, 5, 0.95) 50%, rgba(0, 0, 0, 0.98) 100%)"},pageContent:{background:"linear-gradient(135deg, rgba(5, 15, 8, 0.98) 0%, rgba(2, 8, 4, 0.99) 100%)",width:"calc(100vw - 40px)",height:"100vh",overflowY:"auto",borderRadius:"8px",padding:"20px",position:"relative"}}},6336:(e,t,o)=>{"use strict";o.d(t,{CI:()=>l,Jv:()=>u,dJ:()=>d,wV:()=>h});var n=o(858);o(2446);var r=o(8207),s=o(4232);let i=!1,a=new Set;function c(){a.forEach(e=>e(i))}function l(){window.localStorage.removeItem("wg_secret"),i=null,c(),window.dontReconnect||(console.log("Removing cookies"),function(){for(var e=document.cookie.split("; "),t=0;t<e.length;t++)for(var o=window.location.hostname.split(".");o.length>0;){var n=encodeURIComponent(e[t].split(";")[0].split("=")[0])+"=; expires=Thu, 01-Jan-1970 00:00:01 GMT; domain="+o.join(".")+" ;path=",r=location.pathname.split("/");for(document.cookie=n+"/";r.length>0;)document.cookie=n+r.join("/"),console.log(n+r.join("/")),r.pop();o.shift()}}(),window.location.reload())}function u(){if(console.log("Signing in"),(0,n.a)()){console.log("In iframe");let e=window.location.href;window.open(e,"_blank")}window.login()}function h(){var e,t;let[,o]=(0,s.useState)(i);if((0,s.useEffect)(()=>{let e=e=>{o(e)};return a.add(e),()=>a.delete(e)},[]),window.location.hostname.includes("crazygames")&&window.verifyPayload&&"not_logged_in"===JSON.parse(window.verifyPayload).secret)return{data:null};if(!1===i&&!window.fetchingSession&&(null==(e=window.cConfig)?void 0:e.apiUrl)){let e=null;try{e=window.localStorage.getItem("wg_secret")}catch(e){console.error(e)}if(e){window.fetchingSession=!0;let o=performance.now();console.log("[Auth] Starting authentication with retry mechanism (5s timeout, unlimited retries)"),r.A.fetchWithRetry((null==(t=window.cConfig)?void 0:t.apiUrl)+"/api/googleAuth",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({secret:e})},"googleAuth",{timeout:5e3,maxRetries:1/0,baseDelay:1e3,maxDelay:1e4}).then(e=>e.json()).then(e=>{window.fetchingSession=!1;let t=(performance.now()-o).toFixed(0);if(console.log("[Auth] Authentication successful (took ".concat(t,"ms)")),e.error){console.error("[Auth] Server error:",e.error),i=null,c();return}e.secret?(window.localStorage.setItem("wg_secret",e.secret),i={token:e},console.log("[Auth] Session established for user:",e.username)):(console.log("[Auth] No session data received, user not logged in"),i=null),c()}).catch(e=>{window.fetchingSession=!1;let t=(performance.now()-o).toFixed(0);console.error("[Auth] Authentication failed (took ".concat(t,"ms):"),e.message);try{window.localStorage.removeItem("wg_secret")}catch(e){console.warn("[Auth] Could not clear localStorage:",e)}i=null,c()})}else i=null,c()}return{data:i}}function d(){var e;let t=null;if(i&&(null==i||null==(e=i.token)?void 0:e.secret))t=i.secret;else try{t=window.localStorage.getItem("wg_secret")}catch(e){console.error(e)}return t?{Authorization:"Bearer "+t}:{}}},7328:(e,t,o)=>{e.exports=o(9836)},8207:(e,t,o)=>{"use strict";o.d(t,{A:()=>r});class n{async fetchWithRetry(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},{timeout:r=1e4,maxRetries:s=this.maxRetries,baseDelay:i=this.baseDelay,maxDelay:a=this.maxDelay}=n,c=s===1/0?1e3:s,l=this.retryAttempts.get(o)||0;console.log("[RetryFetch] Attempting ".concat(o," (attempt ").concat(l+1,"/").concat(s===1/0?"âˆž":c+1,")"));let u=new AbortController,h=setTimeout(()=>u.abort(),r);try{let n=await fetch(e,{...t,signal:u.signal});if(clearTimeout(h),!n.ok)throw Error("HTTP ".concat(n.status,": ").concat(n.statusText));return this.retryAttempts.delete(o),console.log("[RetryFetch] Success for ".concat(o)),n}catch(r){if(clearTimeout(h),console.warn("[RetryFetch] Error for ".concat(o,":"),r.message),l<c&&this.shouldRetry(r)){let r=Math.min(i*Math.pow(2,l),a);return console.log("[RetryFetch] Retrying ".concat(o," in ").concat(r,"ms...")),this.retryAttempts.set(o,l+1),new Promise((s,i)=>{setTimeout(()=>{this.fetchWithRetry(e,t,o,n).then(s).catch(i)},r)})}throw console.error("[RetryFetch] Failed ".concat(o," after ").concat(l+1," attempts:"),r.message),this.retryAttempts.delete(o),r}}shouldRetry(e){return"AbortError"===e.name||"TypeError"===e.name||e.message&&e.message.includes("fetch")||e.message&&e.message.includes("HTTP 5")}resetRetries(e){this.retryAttempts.delete(e),console.log("[RetryFetch] Reset retry count for ".concat(e))}getRetryCount(e){return this.retryAttempts.get(e)||0}constructor(){this.retryAttempts=new Map,this.maxRetries=5,this.baseDelay=1e3,this.maxDelay=3e4}}let r=new n},9099:(e,t,o)=>{e.exports=o(8253)}},e=>{e.O(0,[938,585,535,173,701,636,593,792],()=>e(e.s=420)),_N_E=e.O()}]);